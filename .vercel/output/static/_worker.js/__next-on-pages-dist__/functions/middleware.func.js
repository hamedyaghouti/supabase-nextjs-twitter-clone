var Ne={};self.__PRERENDER_MANIFEST='{"version":4,"routes":{"/favicon.ico":{"initialHeaders":{"cache-control":"public, max-age=0, must-revalidate","content-type":"image/x-icon","x-next-cache-tags":"_N_T_/layout,_N_T_/favicon.ico/layout,_N_T_/favicon.ico/route,_N_T_/favicon.ico"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data"}],"initialRevalidateSeconds":false,"srcRoute":"/favicon.ico","dataRoute":null}},"dynamicRoutes":{},"notFoundRoutes":[],"preview":{"previewModeId":"4b408978f41767ed4b279934fe4fff73","previewModeSigningKey":"d32e1ca05ccad3c5e707932ec1926fb21448b278fc8a9c89dc5e2feda64fcc33","previewModeEncryptionKey":"c95cf35fd1631994ee63032abfc1b21a3a16c694429ebbdebf3de9049c1e7be1"}}';(()=>{"use strict";var Z={},q={};function S(E){var W=q[E];if(W!==void 0)return W.exports;var J=q[E]={exports:{}},Y=!0;try{Z[E](J,J.exports,S),Y=!1}finally{Y&&delete q[E]}return J.exports}S.m=Z,(()=>{var E=[];S.O=(W,J,Y,w)=>{if(J){w=w||0;for(var L=E.length;L>0&&E[L-1][2]>w;L--)E[L]=E[L-1];E[L]=[J,Y,w];return}for(var R=1/0,L=0;L<E.length;L++){for(var[J,Y,w]=E[L],j=!0,$=0;$<J.length;$++)(w&!1||R>=w)&&Object.keys(S.O).every(V=>S.O[V](J[$]))?J.splice($--,1):(j=!1,w<R&&(R=w));if(j){E.splice(L--,1);var z=Y();z!==void 0&&(W=z)}}return W}})(),S.n=E=>{var W=E&&E.__esModule?()=>E.default:()=>E;return S.d(W,{a:W}),W},(()=>{var E=Object.getPrototypeOf?J=>Object.getPrototypeOf(J):J=>J.__proto__,W;S.t=function(J,Y){if(Y&1&&(J=this(J)),Y&8||typeof J=="object"&&J&&(Y&4&&J.__esModule||Y&16&&typeof J.then=="function"))return J;var w=Object.create(null);S.r(w);var L={};W=W||[null,E({}),E([]),E(E)];for(var R=Y&2&&J;typeof R=="object"&&!~W.indexOf(R);R=E(R))Object.getOwnPropertyNames(R).forEach(j=>L[j]=()=>J[j]);return L.default=()=>J,S.d(w,L),w}})(),S.d=(E,W)=>{for(var J in W)S.o(W,J)&&!S.o(E,J)&&Object.defineProperty(E,J,{enumerable:!0,get:W[J]})},S.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),S.o=(E,W)=>Object.prototype.hasOwnProperty.call(E,W),S.r=E=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(E,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(E,"__esModule",{value:!0})},(()=>{var E={993:0};S.O.j=Y=>E[Y]===0;var W=(Y,w)=>{var[L,R,j]=w,$,z,C=0;if(L.some(H=>E[H]!==0)){for($ in R)S.o(R,$)&&(S.m[$]=R[$]);if(j)var U=j(S)}for(Y&&Y(w);C<L.length;C++)z=L[C],S.o(E,z)&&E[z]&&E[z][0](),E[z]=0;return S.O(U)},J=self.webpackChunk_N_E=self.webpackChunk_N_E||[];J.forEach(W.bind(null,0)),J.push=W.bind(null,J.push.bind(J))})()})();(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{3780:(Z,q,S)=>{"use strict";S.r(q),S.d(q,{default:()=>xe});var E={};S.r(E),S.d(E,{default:()=>Kr});async function W(){if("_ENTRIES"in globalThis&&Ne.middleware_instrumentation&&Ne.middleware_instrumentation.register)try{await Ne.middleware_instrumentation.register()}catch(f){throw f.message=`An error occurred while loading instrumentation hook: ${f.message}`,f}}let J=null;function Y(){return J||(J=W()),J}function w(f){return`The edge runtime does not support Node.js '${f}' module.
Learn More: https://nextjs.org/docs/messages/node-module-in-edge-runtime`}function L(f){let d=new Proxy(function(){},{get(h,p){if(p==="then")return{};throw new Error(w(f))},construct(){throw new Error(w(f))},apply(h,p,v){if(typeof v[0]=="function")return v[0](d);throw new Error(w(f))}});return new Proxy({},{get:()=>d})}function R(){process!==S.g.process&&(process.env=S.g.process.env,S.g.process=process),Object.defineProperty(globalThis,"__import_unsupported",{value:L,enumerable:!1,configurable:!0}),Y()}R();class j extends Error{constructor({page:d}){super(`The middleware "${d}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class $ extends Error{constructor(){super("The request.page has been deprecated in favour of `URLPattern`.\n  Read more: https://nextjs.org/docs/messages/middleware-request-page\n  ")}}class z extends Error{constructor(){super("The request.ua has been removed in favour of `userAgent` function.\n  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent\n  ")}}function C(f){let d=new Headers;for(let[h,p]of Object.entries(f)){let v=Array.isArray(p)?p:[p];for(let O of v)typeof O>"u"||(typeof O=="number"&&(O=O.toString()),d.append(h,O))}return d}function U(f){var d=[],h=0,p,v,O,N,M;function oe(){for(;h<f.length&&/\s/.test(f.charAt(h));)h+=1;return h<f.length}function he(){return v=f.charAt(h),v!=="="&&v!==";"&&v!==","}for(;h<f.length;){for(p=h,M=!1;oe();)if(v=f.charAt(h),v===","){for(O=h,h+=1,oe(),N=h;h<f.length&&he();)h+=1;h<f.length&&f.charAt(h)==="="?(M=!0,h=N,d.push(f.substring(p,O)),p=h):h=O+1}else h+=1;(!M||h>=f.length)&&d.push(f.substring(p,f.length))}return d}function H(f){let d={},h=[];if(f)for(let[p,v]of f.entries())p.toLowerCase()==="set-cookie"?(h.push(...U(v)),d[p]=h.length===1?h[0]:h):d[p]=v;return d}function K(f){try{return String(new URL(String(f)))}catch(d){throw new Error(`URL is malformed "${String(f)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:d})}}let V=Symbol("response"),Q=Symbol("passThrough"),se=Symbol("waitUntil");class y{constructor(d){this[se]=[],this[Q]=!1}respondWith(d){this[V]||(this[V]=Promise.resolve(d))}passThroughOnException(){this[Q]=!0}waitUntil(d){this[se].push(d)}}class A extends y{constructor(d){super(d.request),this.sourcePage=d.page}get request(){throw new j({page:this.sourcePage})}respondWith(){throw new j({page:this.sourcePage})}}function x(f,d,h){if(!!f){h&&(h=h.toLowerCase());for(let O of f){var p,v;let N=(p=O.domain)==null?void 0:p.split(":")[0].toLowerCase();if(d===N||h===O.defaultLocale.toLowerCase()||((v=O.locales)==null?void 0:v.some(M=>M.toLowerCase()===h)))return O}}}function F(f){return f.replace(/\/$/,"")||"/"}function X(f){let d=f.indexOf("#"),h=f.indexOf("?"),p=h>-1&&(d<0||h<d);return p||d>-1?{pathname:f.substring(0,p?h:d),query:p?f.substring(h,d>-1?d:void 0):"",hash:d>-1?f.slice(d):""}:{pathname:f,query:"",hash:""}}function le(f,d){if(!f.startsWith("/")||!d)return f;let{pathname:h,query:p,hash:v}=X(f);return""+d+h+p+v}function ge(f,d){if(!f.startsWith("/")||!d)return f;let{pathname:h,query:p,hash:v}=X(f);return""+h+d+p+v}function _e(f,d){if(typeof f!="string")return!1;let{pathname:h}=X(f);return h===d||h.startsWith(d+"/")}function Ce(f,d,h,p){if(!d||d===h)return f;let v=f.toLowerCase();return!p&&(_e(v,"/api")||_e(v,"/"+d.toLowerCase()))?f:le(f,"/"+d)}function Ie(f){let d=Ce(f.pathname,f.locale,f.buildId?void 0:f.defaultLocale,f.ignorePrefix);return(f.buildId||!f.trailingSlash)&&(d=F(d)),f.buildId&&(d=ge(le(d,"/_next/data/"+f.buildId),f.pathname==="/"?"index.json":".json")),d=le(d,f.basePath),!f.buildId&&f.trailingSlash?d.endsWith("/")?d:ge(d,"/"):F(d)}function De(f,d){let h;if(d?.host&&!Array.isArray(d.host))h=d.host.toString().split(":")[0];else if(f.hostname)h=f.hostname;else return;return h.toLowerCase()}function Ue(f,d){let h,p=f.split("/");return(d||[]).some(v=>p[1]&&p[1].toLowerCase()===v.toLowerCase()?(h=v,p.splice(1,1),f=p.join("/")||"/",!0):!1),{pathname:f,detectedLocale:h}}function Te(f,d){if(!_e(f,d))return f;let h=f.slice(d.length);return h.startsWith("/")?h:"/"+h}function k(f,d){var h;let{basePath:p,i18n:v,trailingSlash:O}=(h=d.nextConfig)!=null?h:{},N={pathname:f,trailingSlash:f!=="/"?f.endsWith("/"):O};p&&_e(N.pathname,p)&&(N.pathname=Te(N.pathname,p),N.basePath=p);let M=N.pathname;if(N.pathname.startsWith("/_next/data/")&&N.pathname.endsWith(".json")){let he=N.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),ie=he[0];N.buildId=ie,M=he[1]!=="index"?"/"+he.slice(1).join("/"):"/",d.parseData===!0&&(N.pathname=M)}if(v){let he=d.i18nProvider?d.i18nProvider.analyze(N.pathname):Ue(N.pathname,v.locales);N.locale=he.detectedLocale;var oe;N.pathname=(oe=he.pathname)!=null?oe:N.pathname,!he.detectedLocale&&N.buildId&&(he=d.i18nProvider?d.i18nProvider.analyze(M):Ue(M,v.locales),he.detectedLocale&&(N.locale=he.detectedLocale))}return N}let T=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function G(f,d){return new URL(String(f).replace(T,"localhost"),d&&String(d).replace(T,"localhost"))}let _=Symbol("NextURLInternal");class B{constructor(d,h,p){let v,O;typeof h=="object"&&"pathname"in h||typeof h=="string"?(v=h,O=p||{}):O=p||h||{},this[_]={url:G(d,v??O.base),options:O,basePath:""},this.analyze()}analyze(){var d,h,p,v,O;let N=k(this[_].url.pathname,{nextConfig:this[_].options.nextConfig,parseData:!0,i18nProvider:this[_].options.i18nProvider}),M=De(this[_].url,this[_].options.headers);this[_].domainLocale=this[_].options.i18nProvider?this[_].options.i18nProvider.detectDomainLocale(M):x((h=this[_].options.nextConfig)==null||(d=h.i18n)==null?void 0:d.domains,M);let oe=((p=this[_].domainLocale)==null?void 0:p.defaultLocale)||((O=this[_].options.nextConfig)==null||(v=O.i18n)==null?void 0:v.defaultLocale);this[_].url.pathname=N.pathname,this[_].defaultLocale=oe,this[_].basePath=N.basePath??"",this[_].buildId=N.buildId,this[_].locale=N.locale??oe,this[_].trailingSlash=N.trailingSlash}formatPathname(){return Ie({basePath:this[_].basePath,buildId:this[_].buildId,defaultLocale:this[_].options.forceLocale?void 0:this[_].defaultLocale,locale:this[_].locale,pathname:this[_].url.pathname,trailingSlash:this[_].trailingSlash})}formatSearch(){return this[_].url.search}get buildId(){return this[_].buildId}set buildId(d){this[_].buildId=d}get locale(){return this[_].locale??""}set locale(d){var h,p;if(!this[_].locale||!(!((p=this[_].options.nextConfig)==null||(h=p.i18n)==null)&&h.locales.includes(d)))throw new TypeError(`The NextURL configuration includes no locale "${d}"`);this[_].locale=d}get defaultLocale(){return this[_].defaultLocale}get domainLocale(){return this[_].domainLocale}get searchParams(){return this[_].url.searchParams}get host(){return this[_].url.host}set host(d){this[_].url.host=d}get hostname(){return this[_].url.hostname}set hostname(d){this[_].url.hostname=d}get port(){return this[_].url.port}set port(d){this[_].url.port=d}get protocol(){return this[_].url.protocol}set protocol(d){this[_].url.protocol=d}get href(){let d=this.formatPathname(),h=this.formatSearch();return`${this.protocol}//${this.host}${d}${h}${this.hash}`}set href(d){this[_].url=G(d),this.analyze()}get origin(){return this[_].url.origin}get pathname(){return this[_].url.pathname}set pathname(d){this[_].url.pathname=d}get hash(){return this[_].url.hash}set hash(d){this[_].url.hash=d}get search(){return this[_].url.search}set search(d){this[_].url.search=d}get password(){return this[_].url.password}set password(d){this[_].url.password=d}get username(){return this[_].url.username}set username(d){this[_].url.username=d}get basePath(){return this[_].basePath}set basePath(d){this[_].basePath=d.startsWith("/")?d:`/${d}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new B(String(this),this[_].options)}}var de=S(929);let me=Symbol("internal request");class dr extends Request{constructor(d,h={}){let p=typeof d!="string"&&"url"in d?d.url:String(d);K(p),d instanceof Request?super(d,h):super(p,h);let v=new B(p,{headers:H(this.headers),nextConfig:h.nextConfig});this[me]={cookies:new de.RequestCookies(this.headers),geo:h.geo||{},ip:h.ip,nextUrl:v,url:v.toString()}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,geo:this.geo,ip:this.ip,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[me].cookies}get geo(){return this[me].geo}get ip(){return this[me].ip}get nextUrl(){return this[me].nextUrl}get page(){throw new $}get ua(){throw new z}get url(){return this[me].url}}let ut=Symbol("internal response"),kt=new Set([301,302,303,307,308]);function Tt(f,d){var h;if(!(f==null||(h=f.request)==null)&&h.headers){if(!(f.request.headers instanceof Headers))throw new Error("request.headers must be an instance of Headers");let p=[];for(let[v,O]of f.request.headers)d.set("x-middleware-request-"+v,O),p.push(v);d.set("x-middleware-override-headers",p.join(","))}}class Oe extends Response{constructor(d,h={}){super(d,h),this[ut]={cookies:new de.ResponseCookies(this.headers),url:h.url?new B(h.url,{headers:H(this.headers),nextConfig:h.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[ut].cookies}static json(d,h){let p=Response.json(d,h);return new Oe(p.body,p)}static redirect(d,h){let p=typeof h=="number"?h:h?.status??307;if(!kt.has(p))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');let v=typeof h=="object"?h:{},O=new Headers(v?.headers);return O.set("Location",K(d)),new Oe(null,{...v,headers:O,status:p})}static rewrite(d,h){let p=new Headers(h?.headers);return p.set("x-middleware-rewrite",K(d)),Tt(h,p),new Oe(null,{...h,headers:p})}static next(d){let h=new Headers(d?.headers);return h.set("x-middleware-next","1"),Tt(d,h),new Oe(null,{...d,headers:h})}}function Ot(f,d){let h=typeof d=="string"?new URL(d):d,p=new URL(f,d),v=h.protocol+"//"+h.host;return p.protocol+"//"+p.host===v?p.toString().replace(v,""):p.toString()}let ht="RSC",vn="Next-Action",ft="Next-Router-State-Tree",Me="Next-Router-Prefetch",pt="Next-Url",wn="text/x-component",bn=ht+", "+ft+", "+Me+", "+pt,ur=[[ht],[ft],[Me]],Rt=["__nextFallback","__nextLocale","__nextInferredLocaleFromDefault","__nextDefaultLocale","__nextIsNotFound","_rsc"],hr=["__nextDataReq"];function fr(f){for(let d of Rt)delete f[d]}function yt(f,d){let h=typeof f=="string",p=h?new URL(f):f;for(let v of Rt)p.searchParams.delete(v);if(d)for(let v of hr)p.searchParams.delete(v);return h?p.toString():p}let pr=null;function En(f){for(let d of pr)delete f[d]}function An(f){return ensureLeadingSlash(f.split("/").reduce((d,h,p,v)=>!h||isGroupSegment(h)||h[0]==="@"||(h==="page"||h==="route")&&p===v.length-1?d:d+"/"+h,""))}function yr(f,d){return d?f.replace(/\.rsc($|\?)/,"$1"):f}let gt="nxtP",Jt="x-prerender-revalidate",gr="x-prerender-revalidate-if-generated",Lt="x-next-cache-tags",Cn="x-next-cache-soft-tags",xn="x-next-revalidated-tags",Pe="x-next-revalidate-tag-token",Ht=256,Ut=1024,In="_N_T_",mr=31536e3,Wt="middleware",Kt=null,_r="instrumentation",vr="private-next-pages",Pn="private-dot-next",wr="private-next-root-dir",kn="private-next-app-dir",Tn="private-next-rsc-mod-ref-proxy",On="private-next-rsc-action-validate",Rn="private-next-rsc-action-proxy",Jn="private-next-rsc-action-client-wrapper",Ln=null,br=null,Sr=null,Hn=null,Un=null,Wn=null,Kn="Your `getStaticProps` function did not return an object. Did you forget to add a `return`?",Nn="Your `getServerSideProps` function did not return an object. Did you forget to add a `return`?",Dn=null,Mn=null,$n=null,jn=null,Fn=null,Bn=[{title:"Strict",recommended:!0,config:{extends:"next/core-web-vitals"}},{title:"Base",config:{extends:"next"}},{title:"Cancel",config:null}],Gn={edge:"edge",experimentalEdge:"experimental-edge",nodejs:"nodejs"},ve={shared:"shared",reactServerComponents:"rsc",serverSideRendering:"ssr",actionBrowser:"action-browser",api:"api",middleware:"middleware",edgeAsset:"edge-asset",appPagesBrowser:"app-pages-browser",appMetadataRoute:"app-metadata-route",appRouteHandler:"app-route-handler"},zn={...ve,GROUP:{server:[ve.reactServerComponents,ve.actionBrowser,ve.appMetadataRoute,ve.appRouteHandler],nonClientServerTarget:[ve.middleware,ve.api],app:[ve.reactServerComponents,ve.actionBrowser,ve.appMetadataRoute,ve.appRouteHandler,ve.serverSideRendering,ve.appPagesBrowser]}},Vn={edgeSSREntry:"__next_edge_ssr_entry__",metadata:"__next_metadata__",metadataRoute:"__next_metadata_route__",metadataImageMeta:"__next_metadata_image_meta__"};class Se{static get(d,h,p){let v=Reflect.get(d,h,p);return typeof v=="function"?v.bind(d):v}static set(d,h,p,v){return Reflect.set(d,h,p,v)}static has(d,h){return Reflect.has(d,h)}static deleteProperty(d,h){return Reflect.deleteProperty(d,h)}}class mt extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new mt}}class Re extends Headers{constructor(d){super(),this.headers=new Proxy(d,{get(h,p,v){if(typeof p=="symbol")return Se.get(h,p,v);let O=p.toLowerCase(),N=Object.keys(d).find(M=>M.toLowerCase()===O);if(!(typeof N>"u"))return Se.get(h,N,v)},set(h,p,v,O){if(typeof p=="symbol")return Se.set(h,p,v,O);let N=p.toLowerCase(),M=Object.keys(d).find(oe=>oe.toLowerCase()===N);return Se.set(h,M??p,v,O)},has(h,p){if(typeof p=="symbol")return Se.has(h,p);let v=p.toLowerCase(),O=Object.keys(d).find(N=>N.toLowerCase()===v);return typeof O>"u"?!1:Se.has(h,O)},deleteProperty(h,p){if(typeof p=="symbol")return Se.deleteProperty(h,p);let v=p.toLowerCase(),O=Object.keys(d).find(N=>N.toLowerCase()===v);return typeof O>"u"?!0:Se.deleteProperty(h,O)}})}static seal(d){return new Proxy(d,{get(h,p,v){switch(p){case"append":case"delete":case"set":return mt.callable;default:return Se.get(h,p,v)}}})}merge(d){return Array.isArray(d)?d.join(", "):d}static from(d){return d instanceof Headers?d:new Re(d)}append(d,h){let p=this.headers[d];typeof p=="string"?this.headers[d]=[p,h]:Array.isArray(p)?p.push(h):this.headers[d]=h}delete(d){delete this.headers[d]}get(d){let h=this.headers[d];return typeof h<"u"?this.merge(h):null}has(d){return typeof this.headers[d]<"u"}set(d,h){this.headers[d]=h}forEach(d,h){for(let[p,v]of this.entries())d.call(h,v,p,this)}*entries(){for(let d of Object.keys(this.headers)){let h=d.toLowerCase(),p=this.get(h);yield[h,p]}}*keys(){for(let d of Object.keys(this.headers))yield d.toLowerCase()}*values(){for(let d of Object.keys(this.headers))yield this.get(d)}[Symbol.iterator](){return this.entries()}}class Qe extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new Qe}}class Er{static seal(d){return new Proxy(d,{get(h,p,v){switch(p){case"clear":case"delete":case"set":return Qe.callable;default:return Se.get(h,p,v)}}})}}let _t=Symbol.for("next.mutated.cookies");function Ar(f){let d=f[_t];return!d||!Array.isArray(d)||d.length===0?[]:d}function qn(f,d){let h=Ar(d);if(h.length===0)return!1;let p=new ResponseCookies(f),v=p.getAll();for(let O of h)p.set(O);for(let O of v)p.set(O);return!0}class Cr{static wrap(d,h){let p=new de.ResponseCookies(new Headers);for(let M of d.getAll())p.set(M);let v=[],O=new Set,N=()=>{var M;let oe=fetch.__nextGetStaticStore==null||(M=fetch.__nextGetStaticStore.call(fetch))==null?void 0:M.getStore();if(oe&&(oe.pathWasRevalidated=!0),v=p.getAll().filter(ie=>O.has(ie.name)),h){let ie=[];for(let je of v){let ne=new de.ResponseCookies(new Headers);ne.set(je),ie.push(ne.toString())}h(ie)}};return new Proxy(p,{get(M,oe,he){switch(oe){case _t:return v;case"delete":return function(...ie){O.add(typeof ie[0]=="string"?ie[0]:ie[0].name);try{M.delete(...ie)}finally{N()}};case"set":return function(...ie){O.add(typeof ie[0]=="string"?ie[0]:ie[0].name);try{return M.set(...ie)}finally{N()}};default:return Se.get(M,oe,he)}}})}}function Xn(f,d){return f.statusCode=d,f}function Yn(f,d,h){if(typeof d=="string"&&(h=d,d=307),typeof d!="number"||typeof h!="string")throw new Error("Invalid redirect arguments. Please use a single argument URL, e.g. res.redirect('/destination') or use a status code and URL, e.g. res.redirect(307, '/destination').");return f.writeHead(d,{Location:h}),f.write(h),f.end(),f}function xr(f,d){let h=Re.from(f.headers),v=h.get(Jt)===d.previewModeId,O=h.has(gr);return{isOnDemandRevalidate:v,revalidateOnlyGenerated:O}}let $e="__prerender_bypass",Ze="__next_preview_data",Nt=null,vt=Symbol(Ze),wt=Symbol($e);function Ir(f,d={}){if(wt in f)return f;let{serialize:h}=S(9104),p=f.getHeader("Set-Cookie");return f.setHeader("Set-Cookie",[...typeof p=="string"?[p]:Array.isArray(p)?p:[],h($e,"",{expires:new Date(0),httpOnly:!0,sameSite:"none",secure:!0,path:"/",...d.path!==void 0?{path:d.path}:void 0}),h(Ze,"",{expires:new Date(0),httpOnly:!0,sameSite:"none",secure:!0,path:"/",...d.path!==void 0?{path:d.path}:void 0})]),Object.defineProperty(f,wt,{value:!0,enumerable:!1}),f}class Pr extends null{constructor(d,h){super(h),this.statusCode=d}}function Qn(f,d,h){f.statusCode=d,f.statusMessage=h,f.end(h)}function Dt({req:f},d,h){let p={configurable:!0,enumerable:!0},v={...p,writable:!0};Object.defineProperty(f,d,{...p,get:()=>{let O=h();return Object.defineProperty(f,d,{...v,value:O}),O},set:O=>{Object.defineProperty(f,d,{...v,value:O})}})}class Mt{constructor(d,h,p,v){var O;let N=d&&xr(h,d).isOnDemandRevalidate,M=(O=p.get($e))==null?void 0:O.value;this.isEnabled=Boolean(!N&&M&&d&&M===d.previewModeId),this._previewModeId=d?.previewModeId,this._mutableCookies=v}enable(){if(!this._previewModeId)throw new Error("Invariant: previewProps missing previewModeId this should never happen");this._mutableCookies.set({name:$e,value:this._previewModeId,httpOnly:!0,sameSite:"none",secure:!0,path:"/"})}disable(){this._mutableCookies.set({name:$e,value:"",httpOnly:!0,sameSite:"none",secure:!0,path:"/",expires:new Date(0)})}}function kr(f){let d=Re.from(f);for(let h of ur)d.delete(h.toString().toLowerCase());return Re.seal(d)}function Tr(f){let d=new de.RequestCookies(Re.from(f));return Er.seal(d)}function Or(f,d){let h=new de.RequestCookies(Re.from(f));return Cr.wrap(h,d)}let Rr={wrap(f,{req:d,res:h,renderOpts:p},v){let O;p&&"previewProps"in p&&(O=p.previewProps);function N(he){h&&h.setHeader("Set-Cookie",he)}let M={},oe={get headers(){return M.headers||(M.headers=kr(d.headers)),M.headers},get cookies(){return M.cookies||(M.cookies=Tr(d.headers)),M.cookies},get mutableCookies(){return M.mutableCookies||(M.mutableCookies=Or(d.headers,p?.onUpdateCookies||(h?N:void 0))),M.mutableCookies},get draftMode(){return M.draftMode||(M.draftMode=new Mt(O,d,this.cookies,this.mutableCookies)),M.draftMode}};return f.run(oe,v,oe)}};var Jr=S(4092);let Lr=(0,Jr.P)();class Hr extends dr{constructor(d){super(d.input,d.init),this.sourcePage=d.page}get request(){throw new j({page:this.sourcePage})}respondWith(){throw new j({page:this.sourcePage})}waitUntil(){throw new j({page:this.sourcePage})}}let Ur=[[ht],[ft],[Me]];async function $t(f){await Y();let d=typeof self.__BUILD_MANIFEST<"u",h=typeof self.__PRERENDER_MANIFEST=="string"?JSON.parse(self.__PRERENDER_MANIFEST):void 0;f.request.url=yr(f.request.url,!0);let p=new B(f.request.url,{headers:f.request.headers,nextConfig:f.request.nextConfig}),v=[...p.searchParams.keys()];for(let ce of v){let we=p.searchParams.getAll(ce);if(ce!==gt&&ce.startsWith(gt)){let St=ce.substring(gt.length);p.searchParams.delete(St);for(let Nr of we)p.searchParams.append(St,Nr);p.searchParams.delete(ce)}}let O=p.buildId;p.buildId="";let N=f.request.headers["x-nextjs-data"];N&&p.pathname==="/index"&&(p.pathname="/");let M=C(f.request.headers),oe=new Map;if(!d)for(let ce of Ur){let we=ce.toString().toLowerCase();M.get(we)&&(oe.set(we,M.get(we)),M.delete(we))}let he=p,ie=new Hr({page:f.page,input:yt(he,!0).toString(),init:{body:f.request.body,geo:f.request.geo,headers:M,ip:f.request.ip,method:f.request.method,nextConfig:f.request.nextConfig,signal:f.request.signal}});N&&Object.defineProperty(ie,"__isData",{enumerable:!1,value:!0}),!globalThis.__incrementalCache&&f.IncrementalCache&&(globalThis.__incrementalCache=new f.IncrementalCache({appDir:!0,fetchCache:!0,minimalMode:!0,fetchCacheKeyPrefix:void 0,dev:!1,requestHeaders:f.request.headers,requestProtocol:"https",getPrerenderManifest:()=>({version:-1,routes:{},dynamicRoutes:{},notFoundRoutes:[],preview:{previewModeId:"development-id"}})}));let je=new A({request:ie,page:f.page}),ne,et;if(f.page==="/middleware"||f.page==="/src/middleware"?ne=await Rr.wrap(Lr,{req:ie,renderOpts:{onUpdateCookies:ce=>{et=ce},previewProps:h?.preview||{previewModeId:"development-id",previewModeEncryptionKey:"",previewModeSigningKey:""}}},()=>f.handler(ie,je)):ne=await f.handler(ie,je),ne&&!(ne instanceof Response))throw new TypeError("Expected an instance of Response to be returned");ne&&et&&ne.headers.set("set-cookie",et);let Bt=ne?.headers.get("x-middleware-rewrite");if(ne&&Bt){let ce=new B(Bt,{forceLocale:!0,headers:f.request.headers,nextConfig:f.request.nextConfig});ce.host===ie.nextUrl.host&&(ce.buildId=O||ce.buildId,ne.headers.set("x-middleware-rewrite",String(ce)));let we=Ot(String(ce),String(p));N&&ne.headers.set("x-nextjs-rewrite",we)}let Gt=ne?.headers.get("Location");if(ne&&Gt&&!d){let ce=new B(Gt,{forceLocale:!1,headers:f.request.headers,nextConfig:f.request.nextConfig});ne=new Response(ne.body,ne),ce.host===ie.nextUrl.host&&(ce.buildId=O||ce.buildId,ne.headers.set("Location",String(ce))),N&&(ne.headers.delete("Location"),ne.headers.set("x-nextjs-redirect",Ot(String(ce),String(p))))}let Fe=ne||Oe.next(),zt=Fe.headers.get("x-middleware-override-headers"),bt=[];if(zt){for(let[ce,we]of oe)Fe.headers.set(`x-middleware-request-${ce}`,we),bt.push(ce);bt.length>0&&Fe.headers.set("x-middleware-override-headers",zt+","+bt.join(","))}return{response:Fe,waitUntil:Promise.all(je[se]),fetchMetrics:ie.fetchMetrics}}var Wr=S(144);async function Kr(f){let d=Oe.next();return await(0,Wr.createMiddlewareClient)({req:f,res:d}).auth.getSession(),d}let jt={...E},Ft=jt.middleware||jt.default;if(typeof Ft!="function")throw new Error('The Middleware "pages/middleware" must export a `middleware` or a `default` function');function xe(f){return $t({...f,page:"/middleware",handler:Ft})}},144:(Z,q,S)=>{"use strict";var E=Object.defineProperty,W=Object.getOwnPropertyDescriptor,J=Object.getOwnPropertyNames,Y=Object.prototype.hasOwnProperty,w=(k,T)=>{for(var G in T)E(k,G,{get:T[G],enumerable:!0})},L=(k,T,G,_)=>{if(T&&typeof T=="object"||typeof T=="function")for(let B of J(T))!Y.call(k,B)&&B!==G&&E(k,B,{get:()=>T[B],enumerable:!(_=W(T,B))||_.enumerable});return k},R=k=>L(E({},"__esModule",{value:!0}),k),j={};w(j,{createBrowserSupabaseClient:()=>De,createClientComponentClient:()=>C,createMiddlewareClient:()=>x,createMiddlewareSupabaseClient:()=>Te,createPagesBrowserClient:()=>U,createPagesServerClient:()=>Q,createRouteHandlerClient:()=>Ce,createServerActionClient:()=>Ie,createServerComponentClient:()=>le,createServerSupabaseClient:()=>Ue}),Z.exports=R(j);var $=S(3303),z;function C({supabaseUrl:k="https://oqetnmealraxzvlallio.supabase.co",supabaseKey:T="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZXRubWVhbHJheHp2bGFsbGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTY5NDQ0NjAsImV4cCI6MjAxMjUyMDQ2MH0.1om7AKUt0r4O2eNzrf3AMdc49VsLSlu5u2K2Qx7MTyc",options:G,cookieOptions:_,isSingleton:B=!0}={}){if(!k||!T)throw new Error("either NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY env variables or supabaseUrl and supabaseKey are required!");let de=()=>{var me;return(0,$.createSupabaseClient)(k,T,{...G,global:{...G?.global,headers:{...(me=G?.global)==null?void 0:me.headers,"X-Client-Info":"@supabase/auth-helpers-nextjs@0.8.1"}},auth:{storageKey:_?.name,storage:new $.BrowserCookieAuthStorageAdapter(_)}})};if(B){let me=z??de();return me}return de()}var U=C,H=S(3303),K=S(8870),V=class extends H.CookieAuthStorageAdapter{constructor(k,T){super(T),this.context=k}getCookie(k){var T;return(0,K.splitCookiesString)(((T=this.context.res.getHeader("set-cookie"))==null?void 0:T.toString())??"").map(B=>(0,H.parseCookies)(B)[k]).find(B=>!!B)??this.context.req.cookies[k]}setCookie(k,T){this._setCookie(k,T)}deleteCookie(k){this._setCookie(k,"",{maxAge:0})}_setCookie(k,T,G){var _;let B=(0,K.splitCookiesString)(((_=this.context.res.getHeader("set-cookie"))==null?void 0:_.toString())??"").filter(me=>!(k in(0,H.parseCookies)(me))),de=(0,H.serializeCookie)(k,T,{...this.cookieOptions,...G,httpOnly:!1});this.context.res.setHeader("set-cookie",[...B,de])}};function Q(k,{supabaseUrl:T="https://oqetnmealraxzvlallio.supabase.co",supabaseKey:G="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZXRubWVhbHJheHp2bGFsbGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTY5NDQ0NjAsImV4cCI6MjAxMjUyMDQ2MH0.1om7AKUt0r4O2eNzrf3AMdc49VsLSlu5u2K2Qx7MTyc",options:_,cookieOptions:B}={}){var de;if(!T||!G)throw new Error("either NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY env variables or supabaseUrl and supabaseKey are required!");return(0,H.createSupabaseClient)(T,G,{..._,global:{..._?.global,headers:{...(de=_?.global)==null?void 0:de.headers,"X-Client-Info":"@supabase/auth-helpers-nextjs@0.8.1"}},auth:{storageKey:B?.name,storage:new V(k,B)}})}var se=S(3303),y=S(8870),A=class extends se.CookieAuthStorageAdapter{constructor(k,T){super(T),this.context=k}getCookie(k){var T;let G=(0,y.splitCookiesString)(((T=this.context.res.headers.get("set-cookie"))==null?void 0:T.toString())??"").map(B=>(0,se.parseCookies)(B)[k]).find(B=>!!B);return G||(0,se.parseCookies)(this.context.req.headers.get("cookie")??"")[k]}setCookie(k,T){this._setCookie(k,T)}deleteCookie(k){this._setCookie(k,"",{maxAge:0})}_setCookie(k,T,G){let _=(0,se.serializeCookie)(k,T,{...this.cookieOptions,...G,httpOnly:!1});this.context.res.headers&&this.context.res.headers.append("set-cookie",_)}};function x(k,{supabaseUrl:T="https://oqetnmealraxzvlallio.supabase.co",supabaseKey:G="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZXRubWVhbHJheHp2bGFsbGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTY5NDQ0NjAsImV4cCI6MjAxMjUyMDQ2MH0.1om7AKUt0r4O2eNzrf3AMdc49VsLSlu5u2K2Qx7MTyc",options:_,cookieOptions:B}={}){var de;if(!T||!G)throw new Error("either NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY env variables or supabaseUrl and supabaseKey are required!");return(0,se.createSupabaseClient)(T,G,{..._,global:{..._?.global,headers:{...(de=_?.global)==null?void 0:de.headers,"X-Client-Info":"@supabase/auth-helpers-nextjs@0.8.1"}},auth:{storageKey:B?.name,storage:new A(k,B)}})}var F=S(3303),X=class extends F.CookieAuthStorageAdapter{constructor(k,T){super(T),this.context=k}getCookie(k){var T;return(T=this.context.cookies().get(k))==null?void 0:T.value}setCookie(k,T){}deleteCookie(k){}};function le(k,{supabaseUrl:T="https://oqetnmealraxzvlallio.supabase.co",supabaseKey:G="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZXRubWVhbHJheHp2bGFsbGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTY5NDQ0NjAsImV4cCI6MjAxMjUyMDQ2MH0.1om7AKUt0r4O2eNzrf3AMdc49VsLSlu5u2K2Qx7MTyc",options:_,cookieOptions:B}={}){var de;if(!T||!G)throw new Error("either NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY env variables or supabaseUrl and supabaseKey are required!");return(0,F.createSupabaseClient)(T,G,{..._,global:{..._?.global,headers:{...(de=_?.global)==null?void 0:de.headers,"X-Client-Info":"@supabase/auth-helpers-nextjs@0.8.1"}},auth:{storageKey:B?.name,storage:new X(k,B)}})}var ge=S(3303),_e=class extends ge.CookieAuthStorageAdapter{constructor(k,T){super(T),this.context=k}getCookie(k){var T;return(T=this.context.cookies().get(k))==null?void 0:T.value}setCookie(k,T){this.context.cookies().set(k,T,this.cookieOptions)}deleteCookie(k){this.context.cookies().set(k,"",{maxAge:0})}};function Ce(k,{supabaseUrl:T="https://oqetnmealraxzvlallio.supabase.co",supabaseKey:G="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZXRubWVhbHJheHp2bGFsbGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTY5NDQ0NjAsImV4cCI6MjAxMjUyMDQ2MH0.1om7AKUt0r4O2eNzrf3AMdc49VsLSlu5u2K2Qx7MTyc",options:_,cookieOptions:B}={}){var de;if(!T||!G)throw new Error("either NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY env variables or supabaseUrl and supabaseKey are required!");return(0,ge.createSupabaseClient)(T,G,{..._,global:{..._?.global,headers:{...(de=_?.global)==null?void 0:de.headers,"X-Client-Info":"@supabase/auth-helpers-nextjs@0.8.1"}},auth:{storageKey:B?.name,storage:new _e(k,B)}})}var Ie=Ce;function De({supabaseUrl:k="https://oqetnmealraxzvlallio.supabase.co",supabaseKey:T="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZXRubWVhbHJheHp2bGFsbGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTY5NDQ0NjAsImV4cCI6MjAxMjUyMDQ2MH0.1om7AKUt0r4O2eNzrf3AMdc49VsLSlu5u2K2Qx7MTyc",options:G,cookieOptions:_}={}){return console.warn("Please utilize the `createPagesBrowserClient` function instead of the deprecated `createBrowserSupabaseClient` function. Learn more: https://supabase.com/docs/guides/auth/auth-helpers/nextjs-pages"),U({supabaseUrl:k,supabaseKey:T,options:G,cookieOptions:_})}function Ue(k,{supabaseUrl:T="https://oqetnmealraxzvlallio.supabase.co",supabaseKey:G="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZXRubWVhbHJheHp2bGFsbGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTY5NDQ0NjAsImV4cCI6MjAxMjUyMDQ2MH0.1om7AKUt0r4O2eNzrf3AMdc49VsLSlu5u2K2Qx7MTyc",options:_,cookieOptions:B}={}){return console.warn("Please utilize the `createPagesServerClient` function instead of the deprecated `createServerSupabaseClient` function. Learn more: https://supabase.com/docs/guides/auth/auth-helpers/nextjs-pages"),Q(k,{supabaseUrl:T,supabaseKey:G,options:_,cookieOptions:B})}function Te(k,{supabaseUrl:T="https://oqetnmealraxzvlallio.supabase.co",supabaseKey:G="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xZXRubWVhbHJheHp2bGFsbGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTY5NDQ0NjAsImV4cCI6MjAxMjUyMDQ2MH0.1om7AKUt0r4O2eNzrf3AMdc49VsLSlu5u2K2Qx7MTyc",options:_,cookieOptions:B}={}){return console.warn("Please utilize the `createMiddlewareClient` function instead of the deprecated `createMiddlewareSupabaseClient` function. Learn more: https://supabase.com/docs/guides/auth/auth-helpers/nextjs#middleware"),x(k,{supabaseUrl:T,supabaseKey:G,options:_,cookieOptions:B})}},4466:(Z,q,S)=>{"use strict";var E=function(){if(typeof self<"u")return self;if(typeof S.g<"u")return S.g;throw new Error("unable to locate global object")},W=E();Z.exports=q=W.fetch,W.fetch&&(q.default=W.fetch.bind(W)),q.Headers=W.Headers,q.Request=W.Request,q.Response=W.Response},2286:Z=>{"use strict";var q=function(){if(typeof self=="object"&&self)return self;throw new Error("Unable to resolve global `this`")};Z.exports=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return q()}try{return __global__||q()}finally{delete Object.prototype.__global__}}()},929:Z=>{"use strict";var q=Object.defineProperty,S=Object.getOwnPropertyDescriptor,E=Object.getOwnPropertyNames,W=Object.prototype.hasOwnProperty,J=(y,A)=>{for(var x in A)q(y,x,{get:A[x],enumerable:!0})},Y=(y,A,x,F)=>{if(A&&typeof A=="object"||typeof A=="function")for(let X of E(A))!W.call(y,X)&&X!==x&&q(y,X,{get:()=>A[X],enumerable:!(F=S(A,X))||F.enumerable});return y},w=y=>Y(q({},"__esModule",{value:!0}),y),L={};J(L,{RequestCookies:()=>K,ResponseCookies:()=>V,parseCookie:()=>j,parseSetCookie:()=>$,splitCookiesString:()=>H,stringifyCookie:()=>R}),Z.exports=w(L);function R(y){var A;let x=["path"in y&&y.path&&`Path=${y.path}`,"expires"in y&&(y.expires||y.expires===0)&&`Expires=${(typeof y.expires=="number"?new Date(y.expires):y.expires).toUTCString()}`,"maxAge"in y&&typeof y.maxAge=="number"&&`Max-Age=${y.maxAge}`,"domain"in y&&y.domain&&`Domain=${y.domain}`,"secure"in y&&y.secure&&"Secure","httpOnly"in y&&y.httpOnly&&"HttpOnly","sameSite"in y&&y.sameSite&&`SameSite=${y.sameSite}`].filter(Boolean);return`${y.name}=${encodeURIComponent((A=y.value)!=null?A:"")}; ${x.join("; ")}`}function j(y){let A=new Map;for(let x of y.split(/; */)){if(!x)continue;let F=x.indexOf("=");if(F===-1){A.set(x,"true");continue}let[X,le]=[x.slice(0,F),x.slice(F+1)];try{A.set(X,decodeURIComponent(le??"true"))}catch{}}return A}function $(y){if(!y)return;let[[A,x],...F]=j(y),{domain:X,expires:le,httponly:ge,maxage:_e,path:Ce,samesite:Ie,secure:De}=Object.fromEntries(F.map(([Te,k])=>[Te.toLowerCase(),k])),Ue={name:A,value:decodeURIComponent(x),domain:X,...le&&{expires:new Date(le)},...ge&&{httpOnly:!0},...typeof _e=="string"&&{maxAge:Number(_e)},path:Ce,...Ie&&{sameSite:U(Ie)},...De&&{secure:!0}};return z(Ue)}function z(y){let A={};for(let x in y)y[x]&&(A[x]=y[x]);return A}var C=["strict","lax","none"];function U(y){return y=y.toLowerCase(),C.includes(y)?y:void 0}function H(y){if(!y)return[];var A=[],x=0,F,X,le,ge,_e;function Ce(){for(;x<y.length&&/\s/.test(y.charAt(x));)x+=1;return x<y.length}function Ie(){return X=y.charAt(x),X!=="="&&X!==";"&&X!==","}for(;x<y.length;){for(F=x,_e=!1;Ce();)if(X=y.charAt(x),X===","){for(le=x,x+=1,Ce(),ge=x;x<y.length&&Ie();)x+=1;x<y.length&&y.charAt(x)==="="?(_e=!0,x=ge,A.push(y.substring(F,le)),F=x):x=le+1}else x+=1;(!_e||x>=y.length)&&A.push(y.substring(F,y.length))}return A}var K=class{constructor(y){this._parsed=new Map,this._headers=y;let A=y.get("cookie");if(A){let x=j(A);for(let[F,X]of x)this._parsed.set(F,{name:F,value:X})}}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...y){let A=typeof y[0]=="string"?y[0]:y[0].name;return this._parsed.get(A)}getAll(...y){var A;let x=Array.from(this._parsed);if(!y.length)return x.map(([X,le])=>le);let F=typeof y[0]=="string"?y[0]:(A=y[0])==null?void 0:A.name;return x.filter(([X])=>X===F).map(([X,le])=>le)}has(y){return this._parsed.has(y)}set(...y){let[A,x]=y.length===1?[y[0].name,y[0].value]:y,F=this._parsed;return F.set(A,{name:A,value:x}),this._headers.set("cookie",Array.from(F).map(([X,le])=>R(le)).join("; ")),this}delete(y){let A=this._parsed,x=Array.isArray(y)?y.map(F=>A.delete(F)):A.delete(y);return this._headers.set("cookie",Array.from(A).map(([F,X])=>R(X)).join("; ")),x}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(y=>`${y.name}=${encodeURIComponent(y.value)}`).join("; ")}},V=class{constructor(y){this._parsed=new Map;var A,x;this._headers=y;let F=(A=y.getSetCookie)==null?void 0:A.call(y);(x=y.get("set-cookie"))!=null;let X=Array.isArray(F)?F:H(F);for(let le of X){let ge=$(le);ge&&this._parsed.set(ge.name,ge)}}get(...y){let A=typeof y[0]=="string"?y[0]:y[0].name;return this._parsed.get(A)}getAll(...y){var A;let x=Array.from(this._parsed.values());if(!y.length)return x;let F=typeof y[0]=="string"?y[0]:(A=y[0])==null?void 0:A.name;return x.filter(X=>X.name===F)}has(y){return this._parsed.has(y)}set(...y){let[A,x,F]=y.length===1?[y[0].name,y[0].value,y[0]]:y,X=this._parsed;return X.set(A,se({name:A,value:x,...F})),Q(X,this._headers),this}delete(...y){let[A,x,F]=typeof y[0]=="string"?[y[0]]:[y[0].name,y[0].path,y[0].domain];return this.set({name:A,path:x,domain:F,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(R).join("; ")}};function Q(y,A){A.delete("set-cookie");for(let[,x]of y){let F=R(x);A.append("set-cookie",F)}}function se(y={name:"",value:""}){return typeof y.expires=="number"&&(y.expires=new Date(y.expires)),y.maxAge&&(y.expires=new Date(Date.now()+y.maxAge*1e3)),(y.path===null||y.path===void 0)&&(y.path="/"),y}},9104:Z=>{"use strict";var q="/";(()=>{"use strict";typeof __nccwpck_require__<"u"&&(__nccwpck_require__.ab=q+"/");var S={};(()=>{var E=S;E.parse=L,E.serialize=R;var W=decodeURIComponent,J=encodeURIComponent,Y=/; */,w=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function L($,z){if(typeof $!="string")throw new TypeError("argument str must be a string");for(var C={},U=z||{},H=$.split(Y),K=U.decode||W,V=0;V<H.length;V++){var Q=H[V],se=Q.indexOf("=");if(!(se<0)){var y=Q.substr(0,se).trim(),A=Q.substr(++se,Q.length).trim();A[0]=='"'&&(A=A.slice(1,-1)),C[y]==null&&(C[y]=j(A,K))}}return C}function R($,z,C){var U=C||{},H=U.encode||J;if(typeof H!="function")throw new TypeError("option encode is invalid");if(!w.test($))throw new TypeError("argument name is invalid");var K=H(z);if(K&&!w.test(K))throw new TypeError("argument val is invalid");var V=$+"="+K;if(U.maxAge!=null){var Q=U.maxAge-0;if(isNaN(Q)||!isFinite(Q))throw new TypeError("option maxAge is invalid");V+="; Max-Age="+Math.floor(Q)}if(U.domain){if(!w.test(U.domain))throw new TypeError("option domain is invalid");V+="; Domain="+U.domain}if(U.path){if(!w.test(U.path))throw new TypeError("option path is invalid");V+="; Path="+U.path}if(U.expires){if(typeof U.expires.toUTCString!="function")throw new TypeError("option expires is invalid");V+="; Expires="+U.expires.toUTCString()}if(U.httpOnly&&(V+="; HttpOnly"),U.secure&&(V+="; Secure"),U.sameSite){var se=typeof U.sameSite=="string"?U.sameSite.toLowerCase():U.sameSite;switch(se){case!0:V+="; SameSite=Strict";break;case"lax":V+="; SameSite=Lax";break;case"strict":V+="; SameSite=Strict";break;case"none":V+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return V}function j($,z){try{return z($)}catch{return $}}})(),Z.exports=S})()},8870:Z=>{"use strict";var q={decodeValues:!0,map:!1,silent:!1};function S(w){return typeof w=="string"&&!!w.trim()}function E(w,L){var R=w.split(";").filter(S),j=R.shift(),$=W(j),z=$.name,C=$.value;L=L?Object.assign({},q,L):q;try{C=L.decodeValues?decodeURIComponent(C):C}catch(H){console.error("set-cookie-parser encountered an error while decoding a cookie with value '"+C+"'. Set options.decodeValues to false to disable this feature.",H)}var U={name:z,value:C};return R.forEach(function(H){var K=H.split("="),V=K.shift().trimLeft().toLowerCase(),Q=K.join("=");V==="expires"?U.expires=new Date(Q):V==="max-age"?U.maxAge=parseInt(Q,10):V==="secure"?U.secure=!0:V==="httponly"?U.httpOnly=!0:V==="samesite"?U.sameSite=Q:U[V]=Q}),U}function W(w){var L="",R="",j=w.split("=");return j.length>1?(L=j.shift(),R=j.join("=")):R=w,{name:L,value:R}}function J(w,L){if(L=L?Object.assign({},q,L):q,!w)return L.map?{}:[];if(w.headers)if(typeof w.headers.getSetCookie=="function")w=w.headers.getSetCookie();else if(w.headers["set-cookie"])w=w.headers["set-cookie"];else{var R=w.headers[Object.keys(w.headers).find(function($){return $.toLowerCase()==="set-cookie"})];!R&&w.headers.cookie&&!L.silent&&console.warn("Warning: set-cookie-parser appears to have been called on a request object. It is designed to parse Set-Cookie headers from responses, not Cookie headers from requests. Set the option {silent: true} to suppress this warning."),w=R}if(Array.isArray(w)||(w=[w]),L=L?Object.assign({},q,L):q,L.map){var j={};return w.filter(S).reduce(function($,z){var C=E(z,L);return $[C.name]=C,$},j)}else return w.filter(S).map(function($){return E($,L)})}function Y(w){if(Array.isArray(w))return w;if(typeof w!="string")return[];var L=[],R=0,j,$,z,C,U;function H(){for(;R<w.length&&/\s/.test(w.charAt(R));)R+=1;return R<w.length}function K(){return $=w.charAt(R),$!=="="&&$!==";"&&$!==","}for(;R<w.length;){for(j=R,U=!1;H();)if($=w.charAt(R),$===","){for(z=R,R+=1,H(),C=R;R<w.length&&K();)R+=1;R<w.length&&w.charAt(R)==="="?(U=!0,R=C,L.push(w.substring(j,z)),j=R):R=z+1}else R+=1;(!U||R>=w.length)&&L.push(w.substring(j,w.length))}return L}Z.exports=J,Z.exports.parse=J,Z.exports.parseString=E,Z.exports.splitCookiesString=Y},6782:(Z,q,S)=>{"use strict";var E;if(typeof globalThis=="object")E=globalThis;else try{E=S(2286)}catch{}finally{if(!E)throw new Error("Could not determine global this")}var W=E.WebSocket||E.MozWebSocket,J=S(866);function Y(w,L){var R;return L?R=new W(w,L):R=new W(w),R}W&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(w){Object.defineProperty(Y,w,{get:function(){return W[w]}})}),Z.exports={w3cwebsocket:W?Y:null,version:J}},866:(Z,q,S)=>{"use strict";Z.exports=S(8512).version},4092:(Z,q,S)=>{"use strict";S.d(q,{P:()=>Y});let E=new Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available");class W{disable(){throw E}getStore(){}run(){throw E}exit(){throw E}enterWith(){throw E}}let J=globalThis.AsyncLocalStorage;function Y(){return J?new J:new W}},3303:(Z,q,S)=>{"use strict";S.r(q),S.d(q,{BrowserCookieAuthStorageAdapter:()=>Ri,CookieAuthStorageAdapter:()=>_n,DEFAULT_COOKIE_OPTIONS:()=>lr,createSupabaseClient:()=>Ji,isBrowser:()=>dt,parseCookies:()=>Li,parseSupabaseCookie:()=>gn,serializeCookie:()=>Hi,stringifySupabaseSession:()=>mn});let E=new TextEncoder,W=new TextDecoder,J=null;function Y(...r){let e=r.reduce((s,{length:i})=>s+i,0),t=new Uint8Array(e),n=0;return r.forEach(s=>{t.set(s,n),n+=s.length}),t}function w(r,e){return Y(E.encode(r),new Uint8Array([0]),e)}function L(r,e,t){if(e<0||e>=J)throw new RangeError(`value must be >= 0 and <= ${J-1}. Received ${e}`);r.set([e>>>24,e>>>16,e>>>8,e&255],t)}function R(r){let e=Math.floor(r/J),t=r%J,n=new Uint8Array(8);return L(n,e,0),L(n,t,4),n}function j(r){let e=new Uint8Array(4);return L(e,r),e}function $(r){return Y(j(r.length),r)}async function z(r,e,t){let n=Math.ceil((e>>3)/32),s=new Uint8Array(n*32);for(let i=0;i<n;i++){let a=new Uint8Array(4+r.length+t.length);a.set(j(i+1)),a.set(r,4),a.set(t,4+r.length),s.set(await digest("sha256",a),i*32)}return s.slice(0,e>>3)}let C=r=>{let e=r;typeof e=="string"&&(e=E.encode(e));let t=32768,n=[];for(let s=0;s<e.length;s+=t)n.push(String.fromCharCode.apply(null,e.subarray(s,s+t)));return btoa(n.join(""))},U=r=>C(r).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),H=r=>{let e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},K=r=>{let e=r;e instanceof Uint8Array&&(e=W.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return H(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class V extends null{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)===null||t===void 0||t.call(Error,this,this.constructor)}}class Q extends null{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",n="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=n}}class se extends null{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",n="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=n}}class y extends null{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class A extends null{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class x extends null{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class F extends null{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class X extends null{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class le extends null{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class ge extends null{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}}class _e extends null{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class Ce extends null{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class Ie extends null{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class De extends null{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class Ue extends null{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}let Te=crypto,k=r=>r instanceof CryptoKey,T=Te.getRandomValues.bind(Te);function G(r){switch(r){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new JOSENotSupported(`Unsupported JWE Algorithm: ${r}`)}}let _=r=>random(new Uint8Array(G(r)>>3)),B=(r,e)=>{if(e.length<<3!==bitLength(r))throw new JWEInvalid("Invalid Initialization Vector length")},de=null,me=(r,e)=>{let t=r.byteLength<<3;if(t!==e)throw new JWEInvalid(`Invalid Content Encryption Key length. Expected ${e} bits, got ${t} bits`)},dr=null;async function ut(r,e,t,n,s,i){if(!(e instanceof Uint8Array))throw new TypeError(invalidKeyInput(e,"Uint8Array"));let a=parseInt(r.slice(1,4),10),o=await crypto.subtle.importKey("raw",e.subarray(a>>3),"AES-CBC",!1,["decrypt"]),c=await crypto.subtle.importKey("raw",e.subarray(0,a>>3),{hash:`SHA-${a<<1}`,name:"HMAC"},!1,["sign"]),l=concat(i,n,t,uint64be(i.length<<3)),u=new Uint8Array((await crypto.subtle.sign("HMAC",c,l)).slice(0,a>>3)),g;try{g=timingSafeEqual(s,u)}catch{}if(!g)throw new JWEDecryptionFailed;let m;try{m=new Uint8Array(await crypto.subtle.decrypt({iv:n,name:"AES-CBC"},o,t))}catch{}if(!m)throw new JWEDecryptionFailed;return m}async function kt(r,e,t,n,s,i){let a;e instanceof Uint8Array?a=await crypto.subtle.importKey("raw",e,"AES-GCM",!1,["decrypt"]):(checkEncCryptoKey(e,r,"decrypt"),a=e);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:i,iv:n,name:"AES-GCM",tagLength:128},a,concat(t,s)))}catch{throw new JWEDecryptionFailed}}let Tt=async(r,e,t,n,s,i)=>{if(!isCryptoKey(e)&&!(e instanceof Uint8Array))throw new TypeError(invalidKeyInput(e,...types,"Uint8Array"));switch(checkIvLength(r,n),r){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return e instanceof Uint8Array&&checkCekLength(e,parseInt(r.slice(-3),10)),ut(r,e,t,n,s,i);case"A128GCM":case"A192GCM":case"A256GCM":return e instanceof Uint8Array&&checkCekLength(e,parseInt(r.slice(1,4),10)),kt(r,e,t,n,s,i);default:throw new JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}},Oe=null,Ot=async()=>{throw new JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},ht=async()=>{throw new JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.')},vn=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]],ft=null;function Me(r,e){if(r.algorithm.length!==parseInt(e.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${e}`)}function pt(r,e,t){if(isCryptoKey(r))return checkEncCryptoKey(r,e,t),r;if(r instanceof Uint8Array)return crypto.subtle.importKey("raw",r,"AES-KW",!0,[t]);throw new TypeError(invalidKeyInput(r,...types,"Uint8Array"))}let wn=async(r,e,t)=>{let n=await pt(e,r,"wrapKey");Me(n,r);let s=await crypto.subtle.importKey("raw",t,...bogusWebCrypto);return new Uint8Array(await crypto.subtle.wrapKey("raw",s,n,"AES-KW"))},bn=async(r,e,t)=>{let n=await pt(e,r,"unwrapKey");Me(n,r);let s=await crypto.subtle.unwrapKey("raw",t,n,"AES-KW",...bogusWebCrypto);return new Uint8Array(await crypto.subtle.exportKey("raw",s))};async function ur(r,e,t,n,s=new Uint8Array(0),i=new Uint8Array(0)){if(!isCryptoKey(r))throw new TypeError(invalidKeyInput(r,...types));if(checkEncCryptoKey(r,"ECDH"),!isCryptoKey(e))throw new TypeError(invalidKeyInput(e,...types));checkEncCryptoKey(e,"ECDH","deriveBits");let a=concat(lengthAndInput(encoder.encode(t)),lengthAndInput(s),lengthAndInput(i),uint32be(n)),o;r.algorithm.name==="X25519"?o=256:r.algorithm.name==="X448"?o=448:o=Math.ceil(parseInt(r.algorithm.namedCurve.substr(-3),10)/8)<<3;let c=new Uint8Array(await crypto.subtle.deriveBits({name:r.algorithm.name,public:r},e,o));return concatKdf(c,n,a)}async function Sn(r){if(!isCryptoKey(r))throw new TypeError(invalidKeyInput(r,...types));return crypto.subtle.generateKey(r.algorithm,!0,["deriveBits"])}function Rt(r){if(!isCryptoKey(r))throw new TypeError(invalidKeyInput(r,...types));return["P-256","P-384","P-521"].includes(r.algorithm.namedCurve)||r.algorithm.name==="X25519"||r.algorithm.name==="X448"}function hr(r){if(!(r instanceof Uint8Array)||r.length<8)throw new JWEInvalid("PBES2 Salt Input must be 8 or more octets")}function fr(r,e){if(r instanceof Uint8Array)return crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveBits"]);if(isCryptoKey(r))return checkEncCryptoKey(r,e,"deriveBits","deriveKey"),r;throw new TypeError(invalidKeyInput(r,...types,"Uint8Array"))}async function yt(r,e,t,n){checkP2s(r);let s=concatSalt(e,r),i=parseInt(e.slice(13,16),10),a={hash:`SHA-${e.slice(8,11)}`,iterations:t,name:"PBKDF2",salt:s},o={length:i,name:"AES-KW"},c=await fr(n,e);if(c.usages.includes("deriveBits"))return new Uint8Array(await crypto.subtle.deriveBits(a,c,i));if(c.usages.includes("deriveKey"))return crypto.subtle.deriveKey(a,c,o,!1,["wrapKey","unwrapKey"]);throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}let pr=async(r,e,t,n=2048,s=random(new Uint8Array(16)))=>{let i=await yt(s,r,n,e);return{encryptedKey:await wrap(r.slice(-6),i,t),p2c:n,p2s:base64url(s)}},En=async(r,e,t,n,s)=>{let i=await yt(s,r,n,e);return unwrap(r.slice(-6),i,t)};function An(r){switch(r){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new JOSENotSupported(`alg ${r} is not supported either by JOSE or your javascript runtime`)}}let yr=async(r,e,t)=>{if(!isCryptoKey(e))throw new TypeError(invalidKeyInput(e,...types));if(checkEncCryptoKey(e,r,"encrypt","wrapKey"),checkKeyLength(r,e),e.usages.includes("encrypt"))return new Uint8Array(await crypto.subtle.encrypt(subtleAlgorithm(r),e,t));if(e.usages.includes("wrapKey")){let n=await crypto.subtle.importKey("raw",t,...bogusWebCrypto);return new Uint8Array(await crypto.subtle.wrapKey("raw",n,e,subtleAlgorithm(r)))}throw new TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},gt=async(r,e,t)=>{if(!isCryptoKey(e))throw new TypeError(invalidKeyInput(e,...types));if(checkEncCryptoKey(e,r,"decrypt","unwrapKey"),checkKeyLength(r,e),e.usages.includes("decrypt"))return new Uint8Array(await crypto.subtle.decrypt(subtleAlgorithm(r),e,t));if(e.usages.includes("unwrapKey")){let n=await crypto.subtle.unwrapKey("raw",t,e,subtleAlgorithm(r),...bogusWebCrypto);return new Uint8Array(await crypto.subtle.exportKey("raw",n))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function Jt(r){switch(r){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new JOSENotSupported(`Unsupported JWE Algorithm: ${r}`)}}let gr=r=>random(new Uint8Array(Jt(r)>>3)),Lt=async(r,e,t)=>{if(!isCryptoKey(t))throw new TypeError(invalidKeyInput(t,...types));if(!t.extractable)throw new TypeError("CryptoKey is not extractable");if(t.type!==r)throw new TypeError(`key is not a ${r} key`);return formatPEM(encodeBase64(new Uint8Array(await crypto.subtle.exportKey(e,t))),`${r.toUpperCase()} KEY`)},Cn=r=>Lt("public","spki",r),xn=r=>Lt("private","pkcs8",r),Pe=(r,e,t=0)=>{t===0&&(e.unshift(e.length),e.unshift(6));let n=r.indexOf(e[0],t);if(n===-1)return!1;let s=r.subarray(n,n+e.length);return s.length!==e.length?!1:s.every((i,a)=>i===e[a])||Pe(r,e,n+1)},Ht=r=>{switch(!0){case Pe(r,[42,134,72,206,61,3,1,7]):return"P-256";case Pe(r,[43,129,4,0,34]):return"P-384";case Pe(r,[43,129,4,0,35]):return"P-521";case Pe(r,[43,101,110]):return"X25519";case Pe(r,[43,101,111]):return"X448";case Pe(r,[43,101,112]):return"Ed25519";case Pe(r,[43,101,113]):return"Ed448";default:throw new JOSENotSupported("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},Ut=async(r,e,t,n,s)=>{var i;let a,o,c=new Uint8Array(atob(t.replace(r,"")).split("").map(u=>u.charCodeAt(0))),l=e==="spki";switch(n){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:`SHA-${n.slice(-3)}`},o=l?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.slice(-3)}`},o=l?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:`SHA-${parseInt(n.slice(-3),10)||1}`},o=l?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":a={name:"ECDSA",namedCurve:"P-256"},o=l?["verify"]:["sign"];break;case"ES384":a={name:"ECDSA",namedCurve:"P-384"},o=l?["verify"]:["sign"];break;case"ES512":a={name:"ECDSA",namedCurve:"P-521"},o=l?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let u=Ht(c);a=u.startsWith("P-")?{name:"ECDH",namedCurve:u}:{name:u},o=l?[]:["deriveBits"];break}case"EdDSA":a={name:Ht(c)},o=l?["verify"]:["sign"];break;default:throw new JOSENotSupported('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(e,c,a,(i=s?.extractable)!==null&&i!==void 0?i:!1,o)},In=(r,e,t)=>Ut(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",r,e,t),mr=(r,e,t)=>Ut(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",r,e,t);function Wt(r){let e=[],t=0;for(;t<r.length;){let n=Kt(r.subarray(t));e.push(n),t+=n.byteLength}return e}function Kt(r){let e=0,t=r[0]&31;if(e++,t===31){for(t=0;r[e]>=128;)t=t*128+r[e]-128,e++;t=t*128+r[e]-128,e++}let n=0;if(r[e]<128)n=r[e],e++;else if(n===128){for(n=0;r[e+n]!==0||r[e+n+1]!==0;){if(n>r.byteLength)throw new TypeError("invalid indefinite form length");n++}let i=e+n+2;return{byteLength:i,contents:r.subarray(e,e+n),raw:r.subarray(0,i)}}else{let i=r[e]&127;e++,n=0;for(let a=0;a<i;a++)n=n*256+r[e],e++}let s=e+n;return{byteLength:s,contents:r.subarray(e,s),raw:r.subarray(0,s)}}function _r(r){let e=Wt(Wt(Kt(r).contents)[0].contents);return encodeBase64(e[e[0].raw[0]===160?6:5].raw)}function vr(r){let e=r.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""),t=decodeBase64(e);return formatPEM(_r(t),"PUBLIC KEY")}let Pn=(r,e,t)=>{let n;try{n=vr(r)}catch(s){throw new TypeError("Failed to parse the X.509 certificate",{cause:s})}return mr(n,e,t)};function wr(r){let e,t;switch(r.kty){case"oct":{switch(r.alg){case"HS256":case"HS384":case"HS512":e={name:"HMAC",hash:`SHA-${r.alg.slice(-3)}`},t=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new JOSENotSupported(`${r.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":e={name:"AES-GCM"},t=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":e={name:"AES-KW"},t=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":e={name:"PBKDF2"},t=["deriveBits"];break;default:throw new JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(r.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${r.alg.slice(-3)}`},t=r.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.alg.slice(-3)}`},t=r.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(r.alg.slice(-3),10)||1}`},t=r.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(r.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},t=r.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},t=r.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},t=r.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:r.crv},t=r.d?["deriveBits"]:[];break;default:throw new JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(r.alg){case"EdDSA":e={name:r.crv},t=r.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:r.crv},t=r.d?["deriveBits"]:[];break;default:throw new JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new JOSENotSupported('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:t}}let kn=async r=>{var e,t;if(!r.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:n,keyUsages:s}=wr(r),i=[n,(e=r.ext)!==null&&e!==void 0?e:!1,(t=r.key_ops)!==null&&t!==void 0?t:s];if(n.name==="PBKDF2")return crypto.subtle.importKey("raw",base64url(r.k),...i);let a={...r};return delete a.alg,delete a.use,crypto.subtle.importKey("jwk",a,...i)},Tn=null;async function On(r,e,t){if(typeof r!="string"||r.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return fromSPKI(r,e,t)}async function Rn(r,e,t){if(typeof r!="string"||r.indexOf("-----BEGIN CERTIFICATE-----")!==0)throw new TypeError('"x509" must be X.509 formatted string');return fromX509(r,e,t)}async function Jn(r,e,t){if(typeof r!="string"||r.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return fromPKCS8(r,e,t)}async function Ln(r,e,t){var n;if(!isObject(r))throw new TypeError("JWK must be an object");switch(e||(e=r.alg),r.kty){case"oct":if(typeof r.k!="string"||!r.k)throw new TypeError('missing "k" (Key Value) Parameter value');return t??(t=r.ext!==!0),t?asKeyObject({...r,alg:e,ext:(n=r.ext)!==null&&n!==void 0?n:!1}):decodeBase64URL(r.k);case"RSA":if(r.oth!==void 0)throw new JOSENotSupported('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return asKeyObject({...r,alg:e});default:throw new JOSENotSupported('Unsupported "kty" (Key Type) Parameter value')}}async function br(r,e,t,n,s){if(!(t instanceof Uint8Array))throw new TypeError(invalidKeyInput(t,"Uint8Array"));let i=parseInt(r.slice(1,4),10),a=await crypto.subtle.importKey("raw",t.subarray(i>>3),"AES-CBC",!1,["encrypt"]),o=await crypto.subtle.importKey("raw",t.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),c=new Uint8Array(await crypto.subtle.encrypt({iv:n,name:"AES-CBC"},a,e)),l=concat(s,n,c,uint64be(s.length<<3)),u=new Uint8Array((await crypto.subtle.sign("HMAC",o,l)).slice(0,i>>3));return{ciphertext:c,tag:u}}async function Sr(r,e,t,n,s){let i;t instanceof Uint8Array?i=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["encrypt"]):(checkEncCryptoKey(t,r,"encrypt"),i=t);let a=new Uint8Array(await crypto.subtle.encrypt({additionalData:s,iv:n,name:"AES-GCM",tagLength:128},i,e)),o=a.slice(-16);return{ciphertext:a.slice(0,-16),tag:o}}let Hn=async(r,e,t,n,s)=>{if(!isCryptoKey(t)&&!(t instanceof Uint8Array))throw new TypeError(invalidKeyInput(t,...types,"Uint8Array"));switch(checkIvLength(r,n),r){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&checkCekLength(t,parseInt(r.slice(-3),10)),br(r,e,t,n,s);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&checkCekLength(t,parseInt(r.slice(1,4),10)),Sr(r,e,t,n,s);default:throw new JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}},Un=null;async function Wn(r,e,t,n){let s=r.slice(0,7);n||(n=generateIv(s));let{ciphertext:i,tag:a}=await encrypt(s,t,e,n,new Uint8Array(0));return{encryptedKey:i,iv:base64url(n),tag:base64url(a)}}async function Kn(r,e,t,n,s){let i=r.slice(0,7);return decrypt(i,e,t,n,s,new Uint8Array(0))}async function Nn(r,e,t,n,s){switch(checkKeyType(r,e,"decrypt"),r){case"dir":{if(t!==void 0)throw new JWEInvalid("Encountered unexpected JWE Encrypted Key");return e}case"ECDH-ES":if(t!==void 0)throw new JWEInvalid("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!isObject(n.epk))throw new JWEInvalid('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!ECDH.ecdhAllowed(e))throw new JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let i=await importJWK(n.epk,r),a,o;if(n.apu!==void 0){if(typeof n.apu!="string")throw new JWEInvalid('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{a=base64url(n.apu)}catch{throw new JWEInvalid("Failed to base64url decode the apu")}}if(n.apv!==void 0){if(typeof n.apv!="string")throw new JWEInvalid('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{o=base64url(n.apv)}catch{throw new JWEInvalid("Failed to base64url decode the apv")}}let c=await ECDH.deriveKey(i,e,r==="ECDH-ES"?n.enc:r,r==="ECDH-ES"?cekLength(n.enc):parseInt(r.slice(-5,-2),10),a,o);if(r==="ECDH-ES")return c;if(t===void 0)throw new JWEInvalid("JWE Encrypted Key missing");return aesKw(r.slice(-6),c,t)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(t===void 0)throw new JWEInvalid("JWE Encrypted Key missing");return rsaEs(r,e,t)}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(t===void 0)throw new JWEInvalid("JWE Encrypted Key missing");if(typeof n.p2c!="number")throw new JWEInvalid('JOSE Header "p2c" (PBES2 Count) missing or invalid');let i=s?.maxPBES2Count||1e4;if(n.p2c>i)throw new JWEInvalid('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if(typeof n.p2s!="string")throw new JWEInvalid('JOSE Header "p2s" (PBES2 Salt) missing or invalid');let a;try{a=base64url(n.p2s)}catch{throw new JWEInvalid("Failed to base64url decode the p2s")}return pbes2Kw(r,e,t,n.p2c,a)}case"A128KW":case"A192KW":case"A256KW":{if(t===void 0)throw new JWEInvalid("JWE Encrypted Key missing");return aesKw(r,e,t)}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(t===void 0)throw new JWEInvalid("JWE Encrypted Key missing");if(typeof n.iv!="string")throw new JWEInvalid('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof n.tag!="string")throw new JWEInvalid('JOSE Header "tag" (Authentication Tag) missing or invalid');let i;try{i=base64url(n.iv)}catch{throw new JWEInvalid("Failed to base64url decode the iv")}let a;try{a=base64url(n.tag)}catch{throw new JWEInvalid("Failed to base64url decode the tag")}return aesGcmKw(r,e,t,i,a)}default:throw new JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let Dn=null;function Mn(r,e,t,n,s){if(s.crit!==void 0&&n.crit===void 0)throw new r('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(a=>typeof a!="string"||a.length===0))throw new r('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;t!==void 0?i=new Map([...Object.entries(t),...e.entries()]):i=e;for(let a of n.crit){if(!i.has(a))throw new JOSENotSupported(`Extension Header Parameter "${a}" is not recognized`);if(s[a]===void 0)throw new r(`Extension Header Parameter "${a}" is missing`);if(i.get(a)&&n[a]===void 0)throw new r(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(n.crit)}let $n=null;async function jn(r,e,t){var n;if(!isObject(r))throw new JWEInvalid("Flattened JWE must be an object");if(r.protected===void 0&&r.header===void 0&&r.unprotected===void 0)throw new JWEInvalid("JOSE Header missing");if(typeof r.iv!="string")throw new JWEInvalid("JWE Initialization Vector missing or incorrect type");if(typeof r.ciphertext!="string")throw new JWEInvalid("JWE Ciphertext missing or incorrect type");if(typeof r.tag!="string")throw new JWEInvalid("JWE Authentication Tag missing or incorrect type");if(r.protected!==void 0&&typeof r.protected!="string")throw new JWEInvalid("JWE Protected Header incorrect type");if(r.encrypted_key!==void 0&&typeof r.encrypted_key!="string")throw new JWEInvalid("JWE Encrypted Key incorrect type");if(r.aad!==void 0&&typeof r.aad!="string")throw new JWEInvalid("JWE AAD incorrect type");if(r.header!==void 0&&!isObject(r.header))throw new JWEInvalid("JWE Shared Unprotected Header incorrect type");if(r.unprotected!==void 0&&!isObject(r.unprotected))throw new JWEInvalid("JWE Per-Recipient Unprotected Header incorrect type");let s;if(r.protected)try{let re=base64url(r.protected);s=JSON.parse(decoder.decode(re))}catch{throw new JWEInvalid("JWE Protected Header is invalid")}if(!isDisjoint(s,r.header,r.unprotected))throw new JWEInvalid("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let i={...s,...r.header,...r.unprotected};if(validateCrit(JWEInvalid,new Map,t?.crit,s,i),i.zip!==void 0){if(!s||!s.zip)throw new JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(i.zip!=="DEF")throw new JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:a,enc:o}=i;if(typeof a!="string"||!a)throw new JWEInvalid("missing JWE Algorithm (alg) in JWE Header");if(typeof o!="string"||!o)throw new JWEInvalid("missing JWE Encryption Algorithm (enc) in JWE Header");let c=t&&validateAlgorithms("keyManagementAlgorithms",t.keyManagementAlgorithms),l=t&&validateAlgorithms("contentEncryptionAlgorithms",t.contentEncryptionAlgorithms);if(c&&!c.has(a))throw new JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter not allowed');if(l&&!l.has(o))throw new JOSEAlgNotAllowed('"enc" (Encryption Algorithm) Header Parameter not allowed');let u;if(r.encrypted_key!==void 0)try{u=base64url(r.encrypted_key)}catch{throw new JWEInvalid("Failed to base64url decode the encrypted_key")}let g=!1;typeof e=="function"&&(e=await e(s,r),g=!0);let m;try{m=await decryptKeyManagement(a,e,u,i,t)}catch(re){if(re instanceof TypeError||re instanceof JWEInvalid||re instanceof JOSENotSupported)throw re;m=generateCek(o)}let I,P;try{I=base64url(r.iv)}catch{throw new JWEInvalid("Failed to base64url decode the iv")}try{P=base64url(r.tag)}catch{throw new JWEInvalid("Failed to base64url decode the tag")}let b=encoder.encode((n=r.protected)!==null&&n!==void 0?n:""),D;r.aad!==void 0?D=concat(b,encoder.encode("."),encoder.encode(r.aad)):D=b;let ue;try{ue=base64url(r.ciphertext)}catch{throw new JWEInvalid("Failed to base64url decode the ciphertext")}let fe=await decrypt(o,m,ue,I,P,D);i.zip==="DEF"&&(fe=await(t?.inflateRaw||inflate)(fe));let pe={plaintext:fe};if(r.protected!==void 0&&(pe.protectedHeader=s),r.aad!==void 0)try{pe.additionalAuthenticatedData=base64url(r.aad)}catch{throw new JWEInvalid("Failed to base64url decode the aad")}return r.unprotected!==void 0&&(pe.sharedUnprotectedHeader=r.unprotected),r.header!==void 0&&(pe.unprotectedHeader=r.header),g?{...pe,key:e}:pe}async function Fn(r,e,t){if(r instanceof Uint8Array&&(r=decoder.decode(r)),typeof r!="string")throw new JWEInvalid("Compact JWE must be a string or Uint8Array");let{0:n,1:s,2:i,3:a,4:o,length:c}=r.split(".");if(c!==5)throw new JWEInvalid("Invalid Compact JWE");let l=await flattenedDecrypt({ciphertext:a,iv:i||void 0,protected:n||void 0,tag:o||void 0,encrypted_key:s||void 0},e,t),u={plaintext:l.plaintext,protectedHeader:l.protectedHeader};return typeof e=="function"?{...u,key:l.key}:u}async function Bn(r,e,t){if(!isObject(r))throw new JWEInvalid("General JWE must be an object");if(!Array.isArray(r.recipients)||!r.recipients.every(isObject))throw new JWEInvalid("JWE Recipients missing or incorrect type");if(!r.recipients.length)throw new JWEInvalid("JWE Recipients has no members");for(let n of r.recipients)try{return await flattenedDecrypt({aad:r.aad,ciphertext:r.ciphertext,encrypted_key:n.encrypted_key,header:n.header,iv:r.iv,protected:r.protected,tag:r.tag,unprotected:r.unprotected},e,t)}catch{}throw new JWEDecryptionFailed}let Gn=async r=>{if(r instanceof Uint8Array)return{kty:"oct",k:base64url(r)};if(!isCryptoKey(r))throw new TypeError(invalidKeyInput(r,...types,"Uint8Array"));if(!r.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:e,key_ops:t,alg:n,use:s,...i}=await crypto.subtle.exportKey("jwk",r);return i},ve=null;async function zn(r){return exportPublic(r)}async function Vn(r){return exportPrivate(r)}async function Se(r){return keyToJWK(r)}async function mt(r,e,t,n,s={}){let i,a,o;switch(checkKeyType(r,t,"encrypt"),r){case"dir":{o=t;break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!ECDH.ecdhAllowed(t))throw new JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:c,apv:l}=s,{epk:u}=s;u||(u=(await ECDH.generateEpk(t)).privateKey);let{x:g,y:m,crv:I,kty:P}=await exportJWK(u),b=await ECDH.deriveKey(t,u,r==="ECDH-ES"?e:r,r==="ECDH-ES"?cekLength(e):parseInt(r.slice(-5,-2),10),c,l);if(a={epk:{x:g,crv:I,kty:P}},P==="EC"&&(a.epk.y=m),c&&(a.apu=base64url(c)),l&&(a.apv=base64url(l)),r==="ECDH-ES"){o=b;break}o=n||generateCek(e);let D=r.slice(-6);i=await aesKw(D,b,o);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{o=n||generateCek(e),i=await rsaEs(r,t,o);break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=n||generateCek(e);let{p2c:c,p2s:l}=s;({encryptedKey:i,...a}=await pbes2Kw(r,t,o,c,l));break}case"A128KW":case"A192KW":case"A256KW":{o=n||generateCek(e),i=await aesKw(r,t,o);break}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=n||generateCek(e);let{iv:c}=s;({encryptedKey:i,...a}=await aesGcmKw(r,t,o,c));break}default:throw new JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:i,parameters:a}}let Re=null,Qe=Symbol();class Er{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new JWEInvalid("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!isDisjoint(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(validateCrit(JWEInvalid,new Map,t?.crit,this._protectedHeader,n),n.zip!==void 0){if(!this._protectedHeader||!this._protectedHeader.zip)throw new JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(n.zip!=="DEF")throw new JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:s,enc:i}=n;if(typeof s!="string"||!s)throw new JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(typeof i!="string"||!i)throw new JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let a;if(s==="dir"){if(this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if(s==="ECDH-ES"&&this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");let o;{let P;({cek:o,encryptedKey:a,parameters:P}=await encryptKeyManagement(s,i,e,this._cek,this._keyManagementParameters)),P&&(t&&Qe in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...P}:this.setUnprotectedHeader(P):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...P}:this.setProtectedHeader(P))}this._iv||(this._iv=generateIv(i));let c,l,u;this._protectedHeader?l=encoder.encode(base64url(JSON.stringify(this._protectedHeader))):l=encoder.encode(""),this._aad?(u=base64url(this._aad),c=concat(l,encoder.encode("."),encoder.encode(u))):c=l;let g,m;if(n.zip==="DEF"){let P=await(t?.deflateRaw||deflate)(this._plaintext);({ciphertext:g,tag:m}=await encrypt(i,P,o,this._iv,c))}else({ciphertext:g,tag:m}=await encrypt(i,this._plaintext,o,this._iv,c));let I={ciphertext:base64url(g),iv:base64url(this._iv),tag:base64url(m)};return a&&(I.encrypted_key=base64url(a)),u&&(I.aad=u),this._protectedHeader&&(I.protected=decoder.decode(l)),this._sharedUnprotectedHeader&&(I.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(I.header=this._unprotectedHeader),I}}class _t{constructor(e,t,n){this.parent=e,this.key=t,this.options=n}setUnprotectedHeader(e){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}class Ar{constructor(e){this._recipients=[],this._plaintext=e}addRecipient(e,t){let n=new _t(this,e,{crit:t?.crit});return this._recipients.push(n),n}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(e){var t,n,s;if(!this._recipients.length)throw new JWEInvalid("at least one recipient must be added");if(e={deflateRaw:e?.deflateRaw},this._recipients.length===1){let[c]=this._recipients,l=await new FlattenedEncrypt(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(c.unprotectedHeader).encrypt(c.key,{...c.options,...e}),u={ciphertext:l.ciphertext,iv:l.iv,recipients:[{}],tag:l.tag};return l.aad&&(u.aad=l.aad),l.protected&&(u.protected=l.protected),l.unprotected&&(u.unprotected=l.unprotected),l.encrypted_key&&(u.recipients[0].encrypted_key=l.encrypted_key),l.header&&(u.recipients[0].header=l.header),u}let i;for(let c=0;c<this._recipients.length;c++){let l=this._recipients[c];if(!isDisjoint(this._protectedHeader,this._unprotectedHeader,l.unprotectedHeader))throw new JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let u={...this._protectedHeader,...this._unprotectedHeader,...l.unprotectedHeader},{alg:g}=u;if(typeof g!="string"||!g)throw new JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(g==="dir"||g==="ECDH-ES")throw new JWEInvalid('"dir" and "ECDH-ES" alg may only be used with a single recipient');if(typeof u.enc!="string"||!u.enc)throw new JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(!i)i=u.enc;else if(i!==u.enc)throw new JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients');if(validateCrit(JWEInvalid,new Map,l.options.crit,this._protectedHeader,u),u.zip!==void 0&&(!this._protectedHeader||!this._protectedHeader.zip))throw new JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}let a=generateCek(i),o={ciphertext:"",iv:"",recipients:[],tag:""};for(let c=0;c<this._recipients.length;c++){let l=this._recipients[c],u={};o.recipients.push(u);let m={...this._protectedHeader,...this._unprotectedHeader,...l.unprotectedHeader}.alg.startsWith("PBES2")?2048+c:void 0;if(c===0){let b=await new FlattenedEncrypt(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(a).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(l.unprotectedHeader).setKeyManagementParameters({p2c:m}).encrypt(l.key,{...l.options,...e,[unprotected]:!0});o.ciphertext=b.ciphertext,o.iv=b.iv,o.tag=b.tag,b.aad&&(o.aad=b.aad),b.protected&&(o.protected=b.protected),b.unprotected&&(o.unprotected=b.unprotected),u.encrypted_key=b.encrypted_key,b.header&&(u.header=b.header);continue}let{encryptedKey:I,parameters:P}=await encryptKeyManagement(((t=l.unprotectedHeader)===null||t===void 0?void 0:t.alg)||((n=this._protectedHeader)===null||n===void 0?void 0:n.alg)||((s=this._unprotectedHeader)===null||s===void 0?void 0:s.alg),i,l.key,a,{p2c:m});u.encrypted_key=base64url(I),(l.unprotectedHeader||P)&&(u.header={...l.unprotectedHeader,...P})}return o}}function qn(r,e){let t=`SHA-${r.slice(-3)}`;switch(r){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:r.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new JOSENotSupported(`alg ${r} is not supported either by JOSE or your javascript runtime`)}}let Cr=async(r,e,t,n)=>{let s=await getVerifyKey(r,e,"verify");checkKeyLength(r,s);let i=subtleAlgorithm(r,s.algorithm);try{return await crypto.subtle.verify(i,s,t,n)}catch{return!1}},Xn=null;async function Yn(r,e,t){var n;if(!isObject(r))throw new JWSInvalid("Flattened JWS must be an object");if(r.protected===void 0&&r.header===void 0)throw new JWSInvalid('Flattened JWS must have either of the "protected" or "header" members');if(r.protected!==void 0&&typeof r.protected!="string")throw new JWSInvalid("JWS Protected Header incorrect type");if(r.payload===void 0)throw new JWSInvalid("JWS Payload missing");if(typeof r.signature!="string")throw new JWSInvalid("JWS Signature missing or incorrect type");if(r.header!==void 0&&!isObject(r.header))throw new JWSInvalid("JWS Unprotected Header incorrect type");let s={};if(r.protected)try{let D=base64url(r.protected);s=JSON.parse(decoder.decode(D))}catch{throw new JWSInvalid("JWS Protected Header is invalid")}if(!isDisjoint(s,r.header))throw new JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...s,...r.header},a=validateCrit(JWSInvalid,new Map([["b64",!0]]),t?.crit,s,i),o=!0;if(a.has("b64")&&(o=s.b64,typeof o!="boolean"))throw new JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:c}=i;if(typeof c!="string"||!c)throw new JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=t&&validateAlgorithms("algorithms",t.algorithms);if(l&&!l.has(c))throw new JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter not allowed');if(o){if(typeof r.payload!="string")throw new JWSInvalid("JWS Payload must be a string")}else if(typeof r.payload!="string"&&!(r.payload instanceof Uint8Array))throw new JWSInvalid("JWS Payload must be a string or an Uint8Array instance");let u=!1;typeof e=="function"&&(e=await e(s,r),u=!0),checkKeyType(c,e,"verify");let g=concat(encoder.encode((n=r.protected)!==null&&n!==void 0?n:""),encoder.encode("."),typeof r.payload=="string"?encoder.encode(r.payload):r.payload),m;try{m=base64url(r.signature)}catch{throw new JWSInvalid("Failed to base64url decode the signature")}if(!await verify(c,e,m,g))throw new JWSSignatureVerificationFailed;let P;if(o)try{P=base64url(r.payload)}catch{throw new JWSInvalid("Failed to base64url decode the payload")}else typeof r.payload=="string"?P=encoder.encode(r.payload):P=r.payload;let b={payload:P};return r.protected!==void 0&&(b.protectedHeader=s),r.header!==void 0&&(b.unprotectedHeader=r.header),u?{...b,key:e}:b}async function xr(r,e,t){if(r instanceof Uint8Array&&(r=decoder.decode(r)),typeof r!="string")throw new JWSInvalid("Compact JWS must be a string or Uint8Array");let{0:n,1:s,2:i,length:a}=r.split(".");if(a!==3)throw new JWSInvalid("Invalid Compact JWS");let o=await flattenedVerify({payload:s,protected:n,signature:i},e,t),c={payload:o.payload,protectedHeader:o.protectedHeader};return typeof e=="function"?{...c,key:o.key}:c}async function $e(r,e,t){if(!isObject(r))throw new JWSInvalid("General JWS must be an object");if(!Array.isArray(r.signatures)||!r.signatures.every(isObject))throw new JWSInvalid("JWS Signatures missing or incorrect type");for(let n of r.signatures)try{return await flattenedVerify({header:n.header,payload:r.payload,protected:n.protected,signature:n.signature},e,t)}catch{}throw new JWSSignatureVerificationFailed}let Ze=60,Nt=Ze*60,vt=Nt*24,wt=vt*7,Ir=vt*365.25,Pr=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,Qn=r=>{let e=Pr.exec(r);if(!e)throw new TypeError("Invalid time period format");let t=parseFloat(e[1]);switch(e[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(t);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(t*Ze);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(t*Nt);case"day":case"days":case"d":return Math.round(t*vt);case"week":case"weeks":case"w":return Math.round(t*wt);default:return Math.round(t*Ir)}},Dt=r=>r.toLowerCase().replace(/^application\//,""),Mt=(r,e)=>typeof r=="string"?e.includes(r):Array.isArray(r)?e.some(Set.prototype.has.bind(new Set(r))):!1,kr=(r,e,t={})=>{let{typ:n}=t;if(n&&(typeof r.typ!="string"||Dt(r.typ)!==Dt(n)))throw new JWTClaimValidationFailed('unexpected "typ" JWT header value',"typ","check_failed");let s;try{s=JSON.parse(decoder.decode(e))}catch{}if(!isObject(s))throw new JWTInvalid("JWT Claims Set must be a top-level JSON object");let{requiredClaims:i=[],issuer:a,subject:o,audience:c,maxTokenAge:l}=t;l!==void 0&&i.push("iat"),c!==void 0&&i.push("aud"),o!==void 0&&i.push("sub"),a!==void 0&&i.push("iss");for(let I of new Set(i.reverse()))if(!(I in s))throw new JWTClaimValidationFailed(`missing required "${I}" claim`,I,"missing");if(a&&!(Array.isArray(a)?a:[a]).includes(s.iss))throw new JWTClaimValidationFailed('unexpected "iss" claim value',"iss","check_failed");if(o&&s.sub!==o)throw new JWTClaimValidationFailed('unexpected "sub" claim value',"sub","check_failed");if(c&&!Mt(s.aud,typeof c=="string"?[c]:c))throw new JWTClaimValidationFailed('unexpected "aud" claim value',"aud","check_failed");let u;switch(typeof t.clockTolerance){case"string":u=secs(t.clockTolerance);break;case"number":u=t.clockTolerance;break;case"undefined":u=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:g}=t,m=epoch(g||new Date);if((s.iat!==void 0||l)&&typeof s.iat!="number")throw new JWTClaimValidationFailed('"iat" claim must be a number',"iat","invalid");if(s.nbf!==void 0){if(typeof s.nbf!="number")throw new JWTClaimValidationFailed('"nbf" claim must be a number',"nbf","invalid");if(s.nbf>m+u)throw new JWTClaimValidationFailed('"nbf" claim timestamp check failed',"nbf","check_failed")}if(s.exp!==void 0){if(typeof s.exp!="number")throw new JWTClaimValidationFailed('"exp" claim must be a number',"exp","invalid");if(s.exp<=m-u)throw new JWTExpired('"exp" claim timestamp check failed',"exp","check_failed")}if(l){let I=m-s.iat,P=typeof l=="number"?l:secs(l);if(I-u>P)throw new JWTExpired('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(I<0-u)throw new JWTClaimValidationFailed('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return s};async function Tr(r,e,t){var n;let s=await compactVerify(r,e,t);if(((n=s.protectedHeader.crit)===null||n===void 0?void 0:n.includes("b64"))&&s.protectedHeader.b64===!1)throw new JWTInvalid("JWTs MUST NOT use unencoded payload");let a={payload:jwtPayload(s.protectedHeader,s.payload,t),protectedHeader:s.protectedHeader};return typeof e=="function"?{...a,key:s.key}:a}async function Or(r,e,t){let n=await compactDecrypt(r,e,t),s=jwtPayload(n.protectedHeader,n.plaintext,t),{protectedHeader:i}=n;if(i.iss!==void 0&&i.iss!==s.iss)throw new JWTClaimValidationFailed('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(i.sub!==void 0&&i.sub!==s.sub)throw new JWTClaimValidationFailed('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(i.aud!==void 0&&JSON.stringify(i.aud)!==JSON.stringify(s.aud))throw new JWTClaimValidationFailed('replicated "aud" claim header parameter mismatch',"aud","mismatch");let a={payload:s,protectedHeader:i};return typeof e=="function"?{...a,key:n.key}:a}class Rr{constructor(e){this._flattened=new FlattenedEncrypt(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let n=await this._flattened.encrypt(e,t);return[n.protected,n.encrypted_key,n.iv,n.ciphertext,n.tag].join(".")}}let Jr=async(r,e,t)=>{let n=await getSignKey(r,e,"sign");checkKeyLength(r,n);let s=await crypto.subtle.sign(subtleAlgorithm(r,n.algorithm),n,t);return new Uint8Array(s)},Lr=null;class Hr{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new JWSInvalid("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!isDisjoint(this._protectedHeader,this._unprotectedHeader))throw new JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader},s=validateCrit(JWSInvalid,new Map([["b64",!0]]),t?.crit,this._protectedHeader,n),i=!0;if(s.has("b64")&&(i=this._protectedHeader.b64,typeof i!="boolean"))throw new JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if(typeof a!="string"||!a)throw new JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');checkKeyType(a,e,"sign");let o=this._payload;i&&(o=encoder.encode(base64url(o)));let c;this._protectedHeader?c=encoder.encode(base64url(JSON.stringify(this._protectedHeader))):c=encoder.encode("");let l=concat(c,encoder.encode("."),o),u=await sign(a,e,l),g={signature:base64url(u),payload:""};return i&&(g.payload=decoder.decode(o)),this._unprotectedHeader&&(g.header=this._unprotectedHeader),this._protectedHeader&&(g.protected=decoder.decode(c)),g}}class Ur{constructor(e){this._flattened=new FlattenedSign(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let n=await this._flattened.sign(e,t);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}}class $t{constructor(e,t,n){this.parent=e,this.key=t,this.options=n}setProtectedHeader(e){if(this.protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}class Wr{constructor(e){this._signatures=[],this._payload=e}addSignature(e,t){let n=new $t(this,e,t);return this._signatures.push(n),n}async sign(){if(!this._signatures.length)throw new JWSInvalid("at least one signature must be added");let e={signatures:[],payload:""};for(let t=0;t<this._signatures.length;t++){let n=this._signatures[t],s=new FlattenedSign(this._payload);s.setProtectedHeader(n.protectedHeader),s.setUnprotectedHeader(n.unprotectedHeader);let{payload:i,...a}=await s.sign(n.key,n.options);if(t===0)e.payload=i;else if(e.payload!==i)throw new JWSInvalid("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(a)}return e}}class Kr{constructor(e){if(!isObject(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:epoch(new Date)+secs(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:epoch(new Date)+secs(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:epoch(new Date)}:this._payload={...this._payload,iat:e},this}}class jt extends null{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var n;let s=new CompactSign(encoder.encode(JSON.stringify(this._payload)));if(s.setProtectedHeader(this._protectedHeader),Array.isArray((n=this._protectedHeader)===null||n===void 0?void 0:n.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new JWTInvalid("JWTs MUST NOT use unencoded payload");return s.sign(e,t)}}class Ft extends null{setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let n=new CompactEncrypt(encoder.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),n.setProtectedHeader(this._protectedHeader),this._iv&&n.setInitializationVector(this._iv),this._cek&&n.setContentEncryptionKey(this._cek),this._keyManagementParameters&&n.setKeyManagementParameters(this._keyManagementParameters),n.encrypt(e,t)}}let xe=(r,e)=>{if(typeof r!="string"||!r)throw new JWKInvalid(`${e} missing or invalid`)};async function f(r,e){if(!isObject(r))throw new TypeError("JWK must be an object");if(e??(e="sha256"),e!=="sha256"&&e!=="sha384"&&e!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let t;switch(r.kty){case"EC":xe(r.crv,'"crv" (Curve) Parameter'),xe(r.x,'"x" (X Coordinate) Parameter'),xe(r.y,'"y" (Y Coordinate) Parameter'),t={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":xe(r.crv,'"crv" (Subtype of Key Pair) Parameter'),xe(r.x,'"x" (Public Key) Parameter'),t={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":xe(r.e,'"e" (Exponent) Parameter'),xe(r.n,'"n" (Modulus) Parameter'),t={e:r.e,kty:r.kty,n:r.n};break;case"oct":xe(r.k,'"k" (Key Value) Parameter'),t={k:r.k,kty:r.kty};break;default:throw new JOSENotSupported('"kty" (Key Type) Parameter missing or unsupported')}let n=encoder.encode(JSON.stringify(t));return base64url(await digest(e,n))}async function d(r,e){e??(e="sha256");let t=await f(r,e);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${e.slice(-3)}:${t}`}async function h(r,e){let t={...r,...e?.header};if(!isObject(t.jwk))throw new JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let n=await importJWK({...t.jwk,ext:!0},t.alg,!0);if(n instanceof Uint8Array||n.type!=="public")throw new JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a public key');return n}function p(r){switch(typeof r=="string"&&r.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}function v(r){return r&&typeof r=="object"&&Array.isArray(r.keys)&&r.keys.every(O)}function O(r){return isObject(r)}function N(r){return typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}class M{constructor(e){if(this._cached=new WeakMap,!v(e))throw new JWKSInvalid("JSON Web Key Set malformed");this._jwks=N(e)}async getKey(e,t){let{alg:n,kid:s}={...e,...t?.header},i=p(n),a=this._jwks.keys.filter(l=>{let u=i===l.kty;if(u&&typeof s=="string"&&(u=s===l.kid),u&&typeof l.alg=="string"&&(u=n===l.alg),u&&typeof l.use=="string"&&(u=l.use==="sig"),u&&Array.isArray(l.key_ops)&&(u=l.key_ops.includes("verify")),u&&n==="EdDSA"&&(u=l.crv==="Ed25519"||l.crv==="Ed448"),u)switch(n){case"ES256":u=l.crv==="P-256";break;case"ES256K":u=l.crv==="secp256k1";break;case"ES384":u=l.crv==="P-384";break;case"ES512":u=l.crv==="P-521";break}return u}),{0:o,length:c}=a;if(c===0)throw new JWKSNoMatchingKey;if(c!==1){let l=new JWKSMultipleMatchingKeys,{_cached:u}=this;throw l[Symbol.asyncIterator]=async function*(){for(let g of a)try{yield await oe(u,g,n)}catch{continue}},l}return oe(this._cached,o,n)}}async function oe(r,e,t){let n=r.get(e)||r.set(e,{}).get(e);if(n[t]===void 0){let s=await importJWK({...e,ext:!0},t);if(s instanceof Uint8Array||s.type!=="public")throw new JWKSInvalid("JSON Web Key Set members must be public keys");n[t]=s}return n[t]}function he(r){let e=new M(r);return async function(t,n){return e.getKey(t,n)}}let ie=async(r,e,t)=>{let n,s,i=!1;typeof AbortController=="function"&&(n=new AbortController,s=setTimeout(()=>{i=!0,n.abort()},e));let a=await fetch(r.href,{signal:n?n.signal:void 0,redirect:"manual",headers:t.headers}).catch(o=>{throw i?new JWKSTimeout:o});if(s!==void 0&&clearTimeout(s),a.status!==200)throw new JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch{throw new JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}},je=null;function ne(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||!0}class et extends null{constructor(e,t){if(super({keys:[]}),this._jwks=void 0,!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration=typeof t?.timeoutDuration=="number"?t?.timeoutDuration:5e3,this._cooldownDuration=typeof t?.cooldownDuration=="number"?t?.cooldownDuration:3e4,this._cacheMaxAge=typeof t?.cacheMaxAge=="number"?t?.cacheMaxAge:6e5}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(e,t){(!this._jwks||!this.fresh())&&await this.reload();try{return await super.getKey(e,t)}catch(n){if(n instanceof JWKSNoMatchingKey&&this.coolingDown()===!1)return await this.reload(),super.getKey(e,t);throw n}}async reload(){this._pendingFetch&&ne()&&(this._pendingFetch=void 0),this._pendingFetch||(this._pendingFetch=fetchJwks(this._url,this._timeoutDuration,this._options).then(e=>{if(!isJWKSLike(e))throw new JWKSInvalid("JSON Web Key Set malformed");this._jwks={keys:e.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e})),await this._pendingFetch}}function Zn(r,e){let t=new et(r,e);return async function(n,s){return t.getKey(n,s)}}class Bt extends null{encode(){let e=base64url.encode(JSON.stringify({alg:"none"})),t=base64url.encode(JSON.stringify(this._payload));return`${e}.${t}.`}static decode(e,t){if(typeof e!="string")throw new JWTInvalid("Unsecured JWT must be a string");let{0:n,1:s,2:i,length:a}=e.split(".");if(a!==3||i!=="")throw new JWTInvalid("Invalid Unsecured JWT");let o;try{if(o=JSON.parse(decoder.decode(base64url.decode(n))),o.alg!=="none")throw new Error}catch{throw new JWTInvalid("Invalid Unsecured JWT")}return{payload:jwtPayload(o,base64url.decode(s),t),header:o}}}let Gt=U,Fe=K;function zt(r){let e;if(typeof r=="string"){let t=r.split(".");(t.length===3||t.length===5)&&([e]=t)}else if(typeof r=="object"&&r)if("protected"in r)e=r.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof e!="string"||!e)throw new Error;let t=JSON.parse(decoder.decode(base64url(e)));if(!isObject(t))throw new Error;return t}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function bt(r){if(typeof r!="string")throw new JWTInvalid("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=r.split(".");if(t===5)throw new JWTInvalid("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new JWTInvalid("Invalid JWT");if(!e)throw new JWTInvalid("JWTs must contain a payload");let n;try{n=base64url(e)}catch{throw new JWTInvalid("Failed to base64url decode the payload")}let s;try{s=JSON.parse(decoder.decode(n))}catch{throw new JWTInvalid("Failed to parse the decoded payload as JSON")}if(!isObject(s))throw new JWTInvalid("Invalid JWT Claims Set");return s}async function ce(r,e){var t;let n,s,i;switch(r){case"HS256":case"HS384":case"HS512":n=parseInt(r.slice(-3),10),s={name:"HMAC",hash:`SHA-${n}`,length:n},i=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return n=parseInt(r.slice(-3),10),random(new Uint8Array(n>>3));case"A128KW":case"A192KW":case"A256KW":n=parseInt(r.slice(1,4),10),s={name:"AES-KW",length:n},i=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":n=parseInt(r.slice(1,4),10),s={name:"AES-GCM",length:n},i=["encrypt","decrypt"];break;default:throw new JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return crypto.subtle.generateKey(s,(t=e?.extractable)!==null&&t!==void 0?t:!1,i)}function we(r){var e;let t=(e=r?.modulusLength)!==null&&e!==void 0?e:2048;if(typeof t!="number"||t<2048)throw new JOSENotSupported("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}async function St(r,e){var t,n,s;let i,a;switch(r){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:we(e)},a=["sign","verify"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:we(e)},a=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:we(e)},a=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":i={name:"ECDSA",namedCurve:"P-256"},a=["sign","verify"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},a=["sign","verify"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},a=["sign","verify"];break;case"EdDSA":a=["sign","verify"];let o=(t=e?.crv)!==null&&t!==void 0?t:"Ed25519";switch(o){case"Ed25519":case"Ed448":i={name:o};break;default:throw new JOSENotSupported("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{a=["deriveKey","deriveBits"];let c=(n=e?.crv)!==null&&n!==void 0?n:"P-256";switch(c){case"P-256":case"P-384":case"P-521":{i={name:"ECDH",namedCurve:c};break}case"X25519":case"X448":i={name:c};break;default:throw new JOSENotSupported("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return crypto.subtle.generateKey(i,(s=e?.extractable)!==null&&s!==void 0?s:!1,a)}async function Nr(r,e){return generate(r,e)}async function Ui(r,e){return generate(r,e)}let es=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(S.t.bind(S,4466,23)).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class Vt extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class ts extends Vt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class rs extends Vt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ns extends Vt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ss=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(n.next(u))}catch(g){a(g)}}function c(u){try{l(n.throw(u))}catch(g){a(g)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((n=n.apply(r,e||[])).next())})};class is{constructor(e,{headers:t={},customFetch:n}={}){this.url=e,this.headers=t,this.fetch=es(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return ss(this,void 0,void 0,function*(){try{let{headers:s,method:i,body:a}=t,o={},c;a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",c=a):typeof a=="string"?(o["Content-Type"]="text/plain",c=a):typeof FormData<"u"&&a instanceof FormData?c=a:(o["Content-Type"]="application/json",c=JSON.stringify(a)));let l=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:c}).catch(I=>{throw new ts(I)}),u=l.headers.get("x-relay-error");if(u&&u==="true")throw new rs(l);if(!l.ok)throw new ns(l);let g=((n=l.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),m;return g==="application/json"?m=yield l.json():g==="application/octet-stream"?m=yield l.blob():g==="multipart/form-data"?m=yield l.formData():m=yield l.text(),{data:m,error:null}}catch(s){return{data:null,error:s}}})}}var Dr=S(4466),Mr=S.n(Dr);class as{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Mr():this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let n=this.fetch,s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,c;let l=null,u=null,g=null,m=i.status,I=i.statusText;if(i.ok){if(this.method!=="HEAD"){let ue=await i.text();ue===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=ue:u=JSON.parse(ue))}let b=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),D=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");b&&D&&D.length>1&&(g=parseInt(D[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(l={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,g=null,m=406,I="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{let b=await i.text();try{l=JSON.parse(b),Array.isArray(l)&&i.status===404&&(u=[],l=null,m=200,I="OK")}catch{i.status===404&&b===""?(m=204,I="No Content"):l={message:b}}if(l&&this.isMaybeSingle&&((c=l?.details)===null||c===void 0?void 0:c.includes("0 rows"))&&(l=null,m=200,I="OK"),l&&this.shouldThrowOnError)throw l}return{error:l,data:u,count:g,status:m,statusText:I}});return this.shouldThrowOnError||(s=s.catch(i=>{var a,o,c;return{error:{message:`${(a=i?.name)!==null&&a!==void 0?a:"FetchError"}: ${i?.message}`,details:`${(o=i?.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=i?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class os extends as{select(e){let t=!1,n=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:s}={}){let i=s?`${s}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){let n=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:n}={}){let s=typeof n>"u"?"offset":`${n}.offset`,i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:s=!1,wal:i=!1,format:a="text"}={}){let o=[e?"analyze":null,t?"verbose":null,n?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${c}"; options=${o};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class Be extends os{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){let n=t.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");let a=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t}={}){let n=t?`${t}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}}class cs{constructor(e,{headers:t={},schema:n,fetch:s}){this.url=e,this.headers=t,this.schema=n,this.fetch=s}select(e,{head:t=!1,count:n}={}){let s=t?"HEAD":"GET",i=!1,a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),n&&(this.headers.Prefer=`count=${n}`),new Be({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:n=!0}={}){let s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),n||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){let a=e.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(a.length>0){let o=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new Be({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:s,defaultToNull:i=!0}={}){let a="POST",o=[`resolution=${n?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),s&&o.push(`count=${s}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){let c=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(c.length>0){let l=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new Be({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){let n="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Be({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){let t="DELETE",n=[];return e&&n.push(`count=${e}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new Be({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}let ls={"X-Client-Info":"postgrest-js/1.8.5"};class qt{constructor(e,{headers:t={},schema:n,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},ls),t),this.schemaName=n,this.fetch=s}from(e){let t=new URL(`${this.url}/${e}`);return new cs(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new qt(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,count:s}={}){let i,a=new URL(`${this.url}/rpc/${e}`),o;n?(i="HEAD",Object.entries(t).forEach(([l,u])=>{a.searchParams.append(l,`${u}`)})):(i="POST",o=t);let c=Object.assign({},this.headers);return s&&(c.Prefer=`count=${s}`),new Be({method:i,url:a,headers:c,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}}var ds=S(6782);let us={"X-Client-Info":"realtime-js/2.8.0"},hs="1.0.0",$r=1e4,fs=1e3;var tt;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(tt||(tt={}));var be;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(be||(be={}));var Ae;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Ae||(Ae={}));var Xt;(function(r){r.websocket="websocket"})(Xt||(Xt={}));var We;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(We||(We={}));class jr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class ps{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){let t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){let s=t.getUint8(1),i=t.getUint8(2),a=this.HEADER_LENGTH+2,o=n.decode(e.slice(a,a+s));a=a+s;let c=n.decode(e.slice(a,a+i));a=a+i;let l=JSON.parse(n.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class Yt{constructor(e,t,n={},s=$r){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){!this.refEvent||this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Fr;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Fr||(Fr={}));class rt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{let{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=rt.syncState(this.state,s,i,a),this.pendingDiffs.forEach(c=>{this.state=rt.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},s=>{let{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=rt.syncDiff(this.state,s,i,a),o())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){let i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(l,u)=>{a[l]||(c[l]=u)}),this.map(a,(l,u)=>{let g=i[l];if(g){let m=u.map(D=>D.presence_ref),I=g.map(D=>D.presence_ref),P=u.filter(D=>I.indexOf(D.presence_ref)<0),b=g.filter(D=>m.indexOf(D.presence_ref)<0);P.length>0&&(o[l]=P),b.length>0&&(c[l]=b)}else o[l]=u}),this.syncDiff(i,{joins:o,leaves:c},n,s)}static syncDiff(e,t,n,s){let{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(o,c)=>{var l;let u=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),u.length>0){let g=e[o].map(I=>I.presence_ref),m=u.filter(I=>g.indexOf(I.presence_ref)<0);e[o].unshift(...m)}n(o,u,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;let u=c.map(g=>g.presence_ref);l=l.filter(g=>u.indexOf(g.presence_ref)<0),e[o]=l,s(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{let s=e[n];return"metas"in s?t[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ae;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(ae||(ae={}));let Br=(r,e,t={})=>{var n;let s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((i,a)=>(i[a]=ys(a,r,e,s),i),{})},ys=(r,e,t,n)=>{let s=e.find(o=>o.name===r),i=s?.type,a=t[r];return i&&!n.includes(i)?Gr(i,a):Qt(a)},Gr=(r,e)=>{if(r.charAt(0)==="_"){let t=r.slice(1,r.length);return vs(e,t)}switch(r){case ae.bool:return gs(e);case ae.float4:case ae.float8:case ae.int2:case ae.int4:case ae.int8:case ae.numeric:case ae.oid:return ms(e);case ae.json:case ae.jsonb:return _s(e);case ae.timestamp:return ws(e);case ae.abstime:case ae.date:case ae.daterange:case ae.int4range:case ae.int8range:case ae.money:case ae.reltime:case ae.text:case ae.time:case ae.timestamptz:case ae.timetz:case ae.tsrange:case ae.tstzrange:return Qt(e);default:return Qt(e)}},Qt=r=>r,gs=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},ms=r=>{if(typeof r=="string"){let e=parseFloat(r);if(!Number.isNaN(e))return e}return r},_s=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},vs=(r,e)=>{if(typeof r!="string")return r;let t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let i,a=r.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Gr(e,o))}return r},ws=r=>typeof r=="string"?r.replace(" ","T"):r;var zr;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(zr||(zr={}));var Vr;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes"})(Vr||(Vr={}));var qr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(qr||(qr={}));class Zt{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=be.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Yt(this,Ae.join,this.params,this.timeout),this.rejoinTimer=new jr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=be.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=be.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=be.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{!this._isJoining()||(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=be.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ae.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new rt(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:a}}=this.params;this._onError(l=>e&&e("CHANNEL_ERROR",l)),this._onClose(()=>e&&e("CLOSED"));let o={},c={broadcast:i,presence:a,postgres_changes:(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(l=>l.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:l})=>{var u;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),l===void 0){e&&e("SUBSCRIBED");return}else{let g=this.bindings.postgres_changes,m=(u=g?.length)!==null&&u!==void 0?u:0,I=[];for(let P=0;P<m;P++){let b=g[P],{filter:{event:D,schema:ue,table:fe,filter:pe}}=b,re=l&&l[P];if(re&&re.event===D&&re.schema===ue&&re.table===fe&&re.filter===pe)I.push(Object.assign(Object.assign({},b),{id:re.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=I,e&&e("SUBSCRIBED");return}}).receive("error",l=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(l).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){let{event:i,payload:a}=e,o={method:"POST",headers:{apikey:(n=this.socket.accessToken)!==null&&n!==void 0?n:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=t.timeout)!==null&&s!==void 0?s:this.timeout)).ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;let l=this._push(e.type,e,t.timeout||this.timeout);l.rateLimited&&i("rate limited"),e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=be.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ae.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(n=>{let s=new Yt(this,Ae.leave,{},e);s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,n){let s=new AbortController,i=setTimeout(()=>s.abort(),n),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),a}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Yt(this,e,t,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,i;let a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:u}=Ae;if(n&&[o,c,l,u].indexOf(a)>=0&&n!==this._joinRef())return;let m=this._onMessage(a,t,n);if(t&&!m)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(I=>{var P,b,D;return((P=I.filter)===null||P===void 0?void 0:P.event)==="*"||((D=(b=I.filter)===null||b===void 0?void 0:b.event)===null||D===void 0?void 0:D.toLocaleLowerCase())===a}).map(I=>I.callback(m,n)):(i=this.bindings[a])===null||i===void 0||i.filter(I=>{var P,b,D,ue,fe,pe;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in I){let re=I.id,Pt=(P=I.filter)===null||P===void 0?void 0:P.event;return re&&((b=t.ids)===null||b===void 0?void 0:b.includes(re))&&(Pt==="*"||Pt?.toLocaleLowerCase()===((D=t.data)===null||D===void 0?void 0:D.type.toLocaleLowerCase()))}else{let re=(fe=(ue=I?.filter)===null||ue===void 0?void 0:ue.event)===null||fe===void 0?void 0:fe.toLocaleLowerCase();return re==="*"||re===((pe=t?.event)===null||pe===void 0?void 0:pe.toLocaleLowerCase())}else return I.type.toLocaleLowerCase()===a}).map(I=>{if(typeof m=="object"&&"ids"in m){let P=m.data,{schema:b,table:D,commit_timestamp:ue,type:fe,errors:pe}=P;m=Object.assign(Object.assign({},{schema:b,table:D,commit_timestamp:ue,eventType:fe,new:{},old:{},errors:pe}),this._getPayloadRecords(P))}I.callback(m,n)})}_isClosed(){return this.state===be.closed}_isJoined(){return this.state===be.joined}_isJoining(){return this.state===be.joining}_isLeaving(){return this.state===be.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){let s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){let n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&Zt.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ae.close,{},e)}_onError(e){this._on(Ae.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=be.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Br(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Br(e.columns,e.old_record)),t}}let bs=()=>{};class Ss{constructor(e,t){var n,s;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=us,this.params={},this.timeout=$r,this.transport=ds.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=bs,this.conn=null,this.sendBuffer=[],this.serializer=new ps,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this._resolveFetch=o=>{let c;return o?c=o:typeof fetch>"u"?c=(...l)=>Promise.resolve().then(S.t.bind(S,4466,23)).then(({default:u})=>u(...l)):c=fetch,(...l)=>c(...l)},this.endPoint=`${e}/${Xt.websocket}`,t?.params&&(this.params=t.params),t?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),t?.transport&&(this.transport=t.transport),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);let i=(n=t?.params)===null||n===void 0?void 0:n.eventsPerSecond;i&&(this.eventsPerSecondLimitMs=Math.floor(1e3/i));let a=(s=t?.params)===null||s===void 0?void 0:s.apikey;a&&(this.accessToken=a),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=t?.encode?t.encode:(o,c)=>c(JSON.stringify(o)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new jr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case tt.connecting:return We.Connecting;case tt.open:return We.Open;case tt.closing:return We.Closing;default:return We.Closed}}isConnected(){return this.connectionState()===We.Open}channel(e,t={config:{}}){let n=new Zt(`realtime:${e}`,t,this);return this.channels.push(n),n}push(e){let{topic:t,event:n,payload:s,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};if(this.log("push",`${t} ${n} (${i})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(n)){if(this._throttle(a)())return"rate limited"}else a();else this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(Ae.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:hs}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:n,event:s,payload:i,ref:a}=t;(a&&a===this.pendingHeartbeatRef||s===i?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${n} ${s} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(n)).forEach(o=>o._trigger(s,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ae.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(!!this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(fs,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class er extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ye(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Es extends er{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Xr extends er{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var As=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(n.next(u))}catch(g){a(g)}}function c(u){try{l(n.throw(u))}catch(g){a(g)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((n=n.apply(r,e||[])).next())})};let Yr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(S.t.bind(S,4466,23)).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Cs=()=>As(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(S.t.bind(S,4466,23))).Response:Response});var Ge=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(n.next(u))}catch(g){a(g)}}function c(u){try{l(n.throw(u))}catch(g){a(g)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((n=n.apply(r,e||[])).next())})};let tr=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),xs=(r,e)=>Ge(void 0,void 0,void 0,function*(){let t=yield Cs();r instanceof t?r.json().then(n=>{e(new Es(tr(n),r.status||500))}).catch(n=>{e(new Xr(tr(n),n))}):e(new Xr(tr(r),r))}),Is=(r,e,t,n)=>{let s={method:r,headers:e?.headers||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};function Et(r,e,t,n,s,i){return Ge(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,Is(e,n,s,i)).then(c=>{if(!c.ok)throw c;return n?.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>xs(c,o))})})}function rr(r,e,t,n){return Ge(this,void 0,void 0,function*(){return Et(r,"GET",e,t,n)})}function Je(r,e,t,n,s){return Ge(this,void 0,void 0,function*(){return Et(r,"POST",e,n,s,t)})}function Ps(r,e,t,n,s){return Ge(this,void 0,void 0,function*(){return Et(r,"PUT",e,n,s,t)})}function Qr(r,e,t,n,s){return Ge(this,void 0,void 0,function*(){return Et(r,"DELETE",e,n,s,t)})}var Ee=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(n.next(u))}catch(g){a(g)}}function c(u){try{l(n.throw(u))}catch(g){a(g)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((n=n.apply(r,e||[])).next())})};let ks={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Zr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ts{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Yr(s)}uploadOrUpdate(e,t,n,s){return Ee(this,void 0,void 0,function*(){try{let i,a=Object.assign(Object.assign({},Zr),s),o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",a.cacheControl)):(i=n,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType);let c=this._removeEmptyFolders(t),l=this._getFinalPath(c),u=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:i,headers:o},a?.duplex?{duplex:a.duplex}:{}));return u.ok?{data:{path:c},error:null}:{data:null,error:yield u.json()}}catch(i){if(ye(i))return{data:null,error:i};throw i}})}upload(e,t,n){return Ee(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return Ee(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c,l=Object.assign({upsert:Zr.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",l.cacheControl)):(c=n,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);let g=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u});return g.ok?{data:{path:i},error:null}:{data:null,error:yield g.json()}}catch(c){if(ye(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e){return Ee(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e),n=yield Je(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+n.url),i=s.searchParams.get("token");if(!i)throw new er("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}update(e,t,n){return Ee(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t){return Ee(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(n){if(ye(n))return{data:null,error:n};throw n}})}copy(e,t){return Ee(this,void 0,void 0,function*(){try{return{data:{path:(yield Je(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(n){if(ye(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,n){return Ee(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Je(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers}),a=n?.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(ye(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return Ee(this,void 0,void 0,function*(){try{let s=yield Je(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(ye(s))return{data:null,error:s};throw s}})}download(e,t){return Ee(this,void 0,void 0,function*(){let s=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),a=i?`?${i}`:"";try{let o=this._getFinalPath(e);return{data:yield(yield rr(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(ye(o))return{data:null,error:o};throw o}})}getPublicUrl(e,t){let n=this._getFinalPath(e),s=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);let o=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&s.push(c);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${l}`)}}}remove(e){return Ee(this,void 0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}list(e,t,n){return Ee(this,void 0,void 0,function*(){try{let s=Object.assign(Object.assign(Object.assign({},ks),t),{prefix:e||""});return{data:yield Je(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(ye(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}let Os={"X-Client-Info":"storage-js/2.5.4"};var ze=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(n.next(u))}catch(g){a(g)}}function c(u){try{l(n.throw(u))}catch(g){a(g)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((n=n.apply(r,e||[])).next())})};class Rs{constructor(e,t={},n){this.url=e,this.headers=Object.assign(Object.assign({},Os),t),this.fetch=Yr(n)}listBuckets(){return ze(this,void 0,void 0,function*(){try{return{data:yield rr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ye(e))return{data:null,error:e};throw e}})}getBucket(e){return ze(this,void 0,void 0,function*(){try{return{data:yield rr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ze(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ye(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return ze(this,void 0,void 0,function*(){try{return{data:yield Ps(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ye(n))return{data:null,error:n};throw n}})}emptyBucket(e){return ze(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ze(this,void 0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}}class Js extends Rs{constructor(e,t={},n){super(e,t,n)}from(e){return new Ts(this.url,this.headers,e,this.fetch)}}let Ls="2.38.1",nt="";typeof Deno<"u"?nt="deno":typeof document<"u"?nt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?nt="react-native":nt="node";let Hs={"X-Client-Info":`supabase-js-${nt}/${Ls}`};var Us=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(n.next(u))}catch(g){a(g)}}function c(u){try{l(n.throw(u))}catch(g){a(g)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((n=n.apply(r,e||[])).next())})};let Ws=r=>{let e;return r?e=r:typeof fetch>"u"?e=Mr():e=fetch,(...t)=>e(...t)},Ks=()=>typeof Headers>"u"?Dr.Headers:Headers,Ns=(r,e,t)=>{let n=Ws(t),s=Ks();return(i,a)=>Us(void 0,void 0,void 0,function*(){var o;let c=(o=yield e())!==null&&o!==void 0?o:r,l=new s(a?.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),n(i,Object.assign(Object.assign({},a),{headers:l}))})};function Di(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var e=Math.random()*16|0,t=r=="x"?e:e&3|8;return t.toString(16)})}function Ds(r){return r.replace(/\/$/,"")}let Mi=()=>!1;function Ms(r,e){let{db:t,auth:n,realtime:s,global:i}=r,{db:a,auth:o,realtime:c,global:l}=e;return{db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),n),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},l),i)}}function $s(r){return Math.round(Date.now()/1e3)+r}function js(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}let ke=()=>typeof document<"u",Ke={tested:!1,writable:!1},st=()=>{if(!ke())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ke.tested)return Ke.writable;let r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Ke.tested=!0,Ke.writable=!0}catch{Ke.tested=!0,Ke.writable=!1}return Ke.writable};function nr(r){let e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}let en=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(S.t.bind(S,4466,23)).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Fs=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Ve=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},At=async(r,e)=>{let t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},sr=async(r,e)=>{await r.removeItem(e)};function Bs(r){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="",n,s,i,a,o,c,l,u=0;for(r=r.replace("-","+").replace("_","/");u<r.length;)a=e.indexOf(r.charAt(u++)),o=e.indexOf(r.charAt(u++)),c=e.indexOf(r.charAt(u++)),l=e.indexOf(r.charAt(u++)),n=a<<2|o>>4,s=(o&15)<<4|c>>2,i=(c&3)<<6|l,t=t+String.fromCharCode(n),c!=64&&s!=0&&(t=t+String.fromCharCode(s)),l!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class Ct{constructor(){this.promise=new Ct.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ct.promiseConstructor=Promise;function tn(r){let e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");let n=t[1];return JSON.parse(Bs(n))}async function Gs(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function zs(r,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{let a=await r(i);if(!e(i,null,a)){n(a);return}}catch(a){if(!e(i,a)){s(a);return}}})()})}function Vs(r){return("0"+r.toString(16)).substr(-2)}function it(){let e=new Uint32Array(56);if(typeof crypto>"u"){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length,s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,Vs).join("")}async function qs(r){let t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}function Xs(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function at(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;let t=await qs(r);return Xs(t)}class ir extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function ee(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Ys extends ir{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function Qs(r){return ee(r)&&r.name==="AuthApiError"}class rn extends ir{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class qe extends ir{constructor(e,t,n){super(e),this.name=t,this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Xe extends qe{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class ar extends qe{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class xt extends qe{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class It extends qe{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class nn extends qe{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class or extends qe{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function sn(r){return ee(r)&&r.name==="AuthRetryableFetchError"}var Zs=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};let ot=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),ei=[502,503,504];async function an(r){if(!Fs(r))throw new or(ot(r),0);if(ei.includes(r.status))throw new or(ot(r),r.status);let e;try{e=await r.json()}catch(t){throw new rn(ot(t),t)}throw new Ys(ot(e),r.status||500)}let ti=(r,e,t,n)=>{let s={method:r,headers:e?.headers||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function te(r,e,t,n){var s;let i=Object.assign({},n?.headers);n?.jwt&&(i.Authorization=`Bearer ${n.jwt}`);let a=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(a.redirect_to=n.redirectTo);let o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await ri(r,e,t+o,{headers:i,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(c):{data:Object.assign({},c),error:null}}async function ri(r,e,t,n,s,i){let a=ti(e,n,s,i),o;try{o=await r(t,a)}catch(c){throw console.error(c),new or(ot(c),0)}if(o.ok||await an(o),n?.noResolveJson)return o;try{return await o.json()}catch(c){await an(c)}}function Le(r){var e;let t=null;ai(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=$s(r.expires_in)));let n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function He(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function ni(r){return{data:r,error:null}}function si(r){let{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i}=r,a=Zs(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function ii(r){return r}function ai(r){return r.access_token&&r.refresh_token&&r.expires_in}var oi=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};class ci{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=en(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await te(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ee(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await te(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:He})}catch(n){if(ee(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{let{options:t}=e,n=oi(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await te(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:si,redirectTo:t?.redirectTo})}catch(t){if(ee(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await te(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:He})}catch(t){if(ee(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,i,a,o,c;try{let l={nextPage:null,lastPage:0,total:0},u=await te(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:ii});if(u.error)throw u.error;let g=await u.json(),m=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,I=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return I.length>0&&(I.forEach(P=>{let b=parseInt(P.split(";")[0].split("=")[1].substring(0,1)),D=JSON.parse(P.split(";")[1].split("=")[1]);l[`${D}Page`]=b}),l.total=parseInt(m)),{data:Object.assign(Object.assign({},g),l),error:null}}catch(l){if(ee(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await te(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:He})}catch(t){if(ee(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await te(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:He})}catch(n){if(ee(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){try{return await te(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:He})}catch(n){if(ee(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){try{let{data:t,error:n}=await te(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(ee(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await te(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ee(t))return{data:null,error:t};throw t}}}let on="2.55.0",li="http://localhost:9999",di="supabase.auth.token",$i="",ui={"X-Client-Info":`gotrue-js/${on}`},cn=10,ji={MAX_RETRIES:10,RETRY_INTERVAL:2},hi={getItem:r=>st()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{!st()||globalThis.localStorage.setItem(r,e)},removeItem:r=>{!st()||globalThis.localStorage.removeItem(r)}};function ln(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function fi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}let Ye={debug:!!(globalThis&&st()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class pi extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class yi extends null{}async function Fi(r,e,t){Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);let n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new yi(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Ye.debug)try{let i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}fi();let gi={url:li,storageKey:di,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ui,flowType:"implicit",debug:!1},ct=30*1e3,dn=3;async function mi(r,e,t){return await t()}class lt{constructor(e){var t;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=lt.nextInstanceID,lt.nextInstanceID+=1,this.instanceID>0&&ke()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let n=Object.assign(Object.assign({},gi),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new ci({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=en(n.fetch),this.lock=n.lock||mi,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:st()?this.storage=hi:(this.memoryStorage={},this.storage=ln(this.memoryStorage)):(this.memoryStorage={},this.storage=ln(this.memoryStorage)),ke()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${on}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{let e=ke()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){let{data:t,error:n}=await this._getSessionFromURL(e);if(n)return this._debug("#_initialize()","error detecting session from URL",n),await this._removeSession(),{error:n};let{session:s,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),await this._saveSession(s),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return ee(e)?{error:e}:{error:new rn("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(e){var t,n,s;try{await this._removeSession();let i;if("email"in e){let{email:u,password:g,options:m}=e,I=null,P=null;if(this.flowType==="pkce"){let b=it();await Ve(this.storage,`${this.storageKey}-code-verifier`,b),I=await at(b),P=b===I?"plain":"s256"}i=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m?.emailRedirectTo,body:{email:u,password:g,data:(t=m?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:m?.captchaToken},code_challenge:I,code_challenge_method:P},xform:Le})}else if("phone"in e){let{phone:u,password:g,options:m}=e;i=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:g,data:(n=m?.data)!==null&&n!==void 0?n:{},channel:(s=m?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:m?.captchaToken}},xform:Le})}else throw new xt("You must provide either an email or phone number and a password");let{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};let c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(ee(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){let{email:i,password:a,options:o}=e;t=await te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Le})}else if("phone"in e){let{phone:i,password:a,options:o}=e;t=await te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Le})}else throw new xt("You must provide either an email or phone number and a password");let{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new ar}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:{user:n.user,session:n.session},error:s})}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,i;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let t=await At(this.storage,`${this.storageKey}-code-verifier`),{data:n,error:s}=await te(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:Le});return await sr(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new ar}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:n,error:s})}async signInWithIdToken(e){await this._removeSession();try{let{options:t,provider:n,token:s,access_token:i,nonce:a}=e,o=await te(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Le}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new ar}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,i,a;try{if(await this._removeSession(),"email"in e){let{email:o,options:c}=e,l=null,u=null;if(this.flowType==="pkce"){let m=it();await Ve(this.storage,`${this.storageKey}-code-verifier`,m),l=await at(m),u=m===l?"plain":"s256"}let{error:g}=await te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(n=c?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:g}}if("phone"in e){let{phone:o,options:c}=e,{data:l,error:u}=await te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(a=c?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l?.message_id},error:u}}throw new xt("You must provide either an email or phone number.")}catch(o){if(ee(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,n;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);let{data:a,error:o}=await te(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Le});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");let c=a.session,l=a.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(s){if(ee(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{return await this._removeSession(),await te(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:ni})}catch(i){if(ee(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Xe;let{error:s}=await te(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(ee(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();let t=`${this.url}/resend`;if("email"in e){let{email:n,type:s,options:i}=e,{error:a}=await te(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:n,type:s,options:i}=e,{data:a,error:o}=await te(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:o}}throw new xt("You must provide either an email or phone number and a type")}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){let s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,t=await At(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let n=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n)return{data:{session:e},error:null};let{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:He}):await this._useSession(async t=>{var n,s;let{data:i,error:a}=t;if(a)throw a;return await te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0,xform:He})})}catch(t){if(ee(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{let{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new Xe;let a=s.session,o=null,c=null;if(this.flowType==="pkce"&&e.email!=null){let g=it();await Ve(this.storage,`${this.storageKey}-code-verifier`,g),o=await at(g),c=g===o?"plain":"s256"}let{data:l,error:u}=await te(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:He});if(u)throw u;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(n){if(ee(n))return{data:{user:null},error:n};throw n}}_decodeJWT(e){return tn(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Xe;let t=Date.now()/1e3,n=t,s=!0,i=null,a=tn(e.access_token);if(a.exp&&(n=a.exp,s=n<=t),s){let{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{let{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(ee(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){let{data:a,error:o}=t;if(o)throw o;e=(n=a.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new Xe;let{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!ke())throw new It("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new It("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new nn("Not a valid PKCE flow url.");let t=nr(window.location.href);if(e){if(!t.code)throw new nn("No code detected.");let{data:fe,error:pe}=await this._exchangeCodeForSession(t.code);if(pe)throw pe;let re=new URL(window.location.href);return re.searchParams.delete("code"),window.history.replaceState(window.history.state,"",re.toString()),{data:{session:fe.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new It(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});let{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=t;if(!i||!o||!a||!l)throw new It("No session defined in URL");let u=Math.round(Date.now()/1e3),g=parseInt(o),m=u+g;c&&(m=parseInt(c));let I=m-u;I*1e3<=ct&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${I}s, should have been closer to ${g}s`);let P=m-g;u-P>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",P,m,u):u-P<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",P,m,u);let{data:b,error:D}=await this._getUser(i);if(D)throw D;let ue={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:g,expires_at:m,refresh_token:a,token_type:l,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:ue,redirectType:t.type},error:null}}catch(t){if(ee(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){let e=nr(window.location.href);return!!(ke()&&(e.access_token||e.error_description))}async _isPKCEFlow(){let e=nr(window.location.href),t=await At(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;let{data:s,error:i}=t;if(i)return{error:i};let a=(n=s.session)===null||n===void 0?void 0:n.access_token;if(a){let{error:o}=await this.admin.signOut(a,e);if(o&&!(Qs(o)&&(o.status===404||o.status===401)))return{error:o}}return e!=="others"&&(await this._removeSession(),await sr(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){let t=js(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{let{data:{session:i},error:a}=t;if(a)throw a;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;if(this.flowType==="pkce"){let i=it();await Ve(this.storage,`${this.storageKey}-code-verifier`,i),n=await at(i),s=i===n?"plain":"s256"}try{return await te(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(ee(i))return{data:null,error:i};throw i}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{let n=Date.now();return await zs(async s=>(await Gs(s*200),this._debug(t,"refreshing attempt",s),await te(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Le})),(s,i,a)=>a&&a.error&&sn(a.error)&&Date.now()+(s+1)*200-n<ct)}catch(n){if(this._debug(t,"error",n),ee(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let n=await this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),ke()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;let t="#_recoverAndRefresh()";this._debug(t,"begin");try{let n=await At(this.storage,this.storageKey);if(this._debug(t,"session from storage",n),!this._isValidSession(n)){this._debug(t,"session is not valid"),n!==null&&await this._removeSession();return}let s=Math.round(Date.now()/1e3),i=((e=n.expires_at)!==null&&e!==void 0?e:1/0)<s+cn;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${cn}s`),i){if(this.autoRefreshToken&&n.refresh_token){let{error:a}=await this._callRefreshToken(n.refresh_token);a&&(console.error(a),sn(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(t,"error",n),console.error(n);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Xe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Ct;let{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Xe;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);let o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(s,"error",i),ee(i)){let a={session:null,error:i};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){let s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});let i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await this._persistSession(e)}_persistSession(e){return this._debug("#_persistSession()",e),Ve(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await sr(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ke()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),ct);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let s=Math.floor((n.expires_at*1e3-e)/ct);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${ct}ms, refresh threshold is ${dn} ticks`),s<=dn&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof pi)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ke()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t){let n=[`provider=${encodeURIComponent(e)}`];if(t?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t?.scopes&&n.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){let s=it();await Ve(this.storage,`${this.storageKey}-code-verifier`,s);let i=await at(s),a=s===i?"plain":"s256";this._debug("PKCE","code verifier",`${s.substring(0,5)}...`,"code challenge",i,"method",a);let o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(o.toString())}if(t?.queryParams){let s=new URLSearchParams(t.queryParams);n.push(s.toString())}return`${this.url}/authorize?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;let{data:s,error:i}=t;return i?{data:null,error:i}:await te(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(ee(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;let{data:i,error:a}=t;if(a)return{data:null,error:a};let{data:o,error:c}=await te(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(!((s=o?.totp)===null||s===void 0)&&s.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(ee(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;let{data:s,error:i}=t;if(i)return{data:null,error:i};let{data:a,error:o}=await te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(ee(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;let{data:s,error:i}=t;return i?{data:null,error:i}:await te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(ee(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){let{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){let{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};let n=e?.factors||[],s=n.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:n,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;let{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(s.access_token),o=null;a.aal&&(o=a.aal);let c=o;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(g=>g.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");let u=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}lt.nextInstanceID=0;class _i extends lt{constructor(e){super(e)}}var vi=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(n.next(u))}catch(g){a(g)}}function c(u){try{l(n.throw(u))}catch(g){a(g)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((n=n.apply(r,e||[])).next())})};let wi={headers:Hs},bi={schema:"public"},Si={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ei={};class Ai{constructor(e,t,n){var s,i,a,o,c,l,u,g;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");let m=Ds(e);this.realtimeUrl=`${m}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${m}/auth/v1`,this.storageUrl=`${m}/storage/v1`,this.functionsUrl=`${m}/functions/v1`;let I=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,P={db:bi,realtime:Ei,auth:Object.assign(Object.assign({},Si),{storageKey:I}),global:wi},b=Ms(n??{},P);this.storageKey=(i=(s=b.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(o=(a=b.global)===null||a===void 0?void 0:a.headers)!==null&&o!==void 0?o:{},this.auth=this._initSupabaseAuthClient((c=b.auth)!==null&&c!==void 0?c:{},this.headers,(l=b.global)===null||l===void 0?void 0:l.fetch),this.fetch=Ns(t,this._getAccessToken.bind(this),(u=b.global)===null||u===void 0?void 0:u.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},b.realtime)),this.rest=new qt(`${m}/rest/v1`,{headers:this.headers,schema:(g=b.db)===null||g===void 0?void 0:g.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new is(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Js(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return vi(this,void 0,void 0,function*(){let{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:i,flowType:a,debug:o},c,l){let u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new _i({url:this.authUrl,headers:Object.assign(Object.assign({},u),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:a,debug:o,fetch:l})}_initRealtimeClient(e){return new Ss(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.realtime.setAuth(n??null),this.changedAccessToken=n):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}let Ci=(r,e,t)=>new Ai(r,e,t);var xi=Object.create,un=Object.defineProperty,Ii=Object.getOwnPropertyDescriptor,hn=Object.getOwnPropertyNames,Pi=Object.getPrototypeOf,ki=Object.prototype.hasOwnProperty,Ti=(r,e)=>function(){return e||(0,r[hn(r)[0]])((e={exports:{}}).exports,e),e.exports},Oi=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of hn(e))!ki.call(r,s)&&s!==t&&un(r,s,{get:()=>e[s],enumerable:!(n=Ii(e,s))||n.enumerable});return r},fn=(r,e,t)=>(t=r!=null?xi(Pi(r)):{},Oi(e||!r||!r.__esModule?un(t,"default",{value:r,enumerable:!0}):t,r)),pn=Ti({"../../node_modules/.pnpm/cookie@0.5.0/node_modules/cookie/index.js"(r){"use strict";r.parse=n,r.serialize=s;var e=Object.prototype.toString,t=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function n(l,u){if(typeof l!="string")throw new TypeError("argument str must be a string");for(var g={},m=u||{},I=m.decode||i,P=0;P<l.length;){var b=l.indexOf("=",P);if(b===-1)break;var D=l.indexOf(";",P);if(D===-1)D=l.length;else if(D<b){P=l.lastIndexOf(";",b-1)+1;continue}var ue=l.slice(P,b).trim();if(g[ue]===void 0){var fe=l.slice(b+1,D).trim();fe.charCodeAt(0)===34&&(fe=fe.slice(1,-1)),g[ue]=c(fe,I)}P=D+1}return g}function s(l,u,g){var m=g||{},I=m.encode||a;if(typeof I!="function")throw new TypeError("option encode is invalid");if(!t.test(l))throw new TypeError("argument name is invalid");var P=I(u);if(P&&!t.test(P))throw new TypeError("argument val is invalid");var b=l+"="+P;if(m.maxAge!=null){var D=m.maxAge-0;if(isNaN(D)||!isFinite(D))throw new TypeError("option maxAge is invalid");b+="; Max-Age="+Math.floor(D)}if(m.domain){if(!t.test(m.domain))throw new TypeError("option domain is invalid");b+="; Domain="+m.domain}if(m.path){if(!t.test(m.path))throw new TypeError("option path is invalid");b+="; Path="+m.path}if(m.expires){var ue=m.expires;if(!o(ue)||isNaN(ue.valueOf()))throw new TypeError("option expires is invalid");b+="; Expires="+ue.toUTCString()}if(m.httpOnly&&(b+="; HttpOnly"),m.secure&&(b+="; Secure"),m.priority){var fe=typeof m.priority=="string"?m.priority.toLowerCase():m.priority;switch(fe){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(m.sameSite){var pe=typeof m.sameSite=="string"?m.sameSite.toLowerCase():m.sameSite;switch(pe){case!0:b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"strict":b+="; SameSite=Strict";break;case"none":b+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return b}function i(l){return l.indexOf("%")!==-1?decodeURIComponent(l):l}function a(l){return encodeURIComponent(l)}function o(l){return e.call(l)==="[object Date]"||l instanceof Date}function c(l,u){try{return u(l)}catch{return l}}}}),cr=fn(pn()),yn=fn(pn());function gn(r){if(!r)return null;try{let e=JSON.parse(r);if(!e)return null;if(e.constructor.name==="Object")return e;if(e.constructor.name!=="Array")throw new Error(`Unexpected format: ${e.constructor.name}`);let[t,n,s]=e[0].split("."),i=Fe(n),a=new TextDecoder,{exp:o,sub:c,...l}=JSON.parse(a.decode(i));return{expires_at:o,expires_in:o-Math.round(Date.now()/1e3),token_type:"bearer",access_token:e[0],refresh_token:e[1],provider_token:e[2],provider_refresh_token:e[3],user:{id:c,factors:e[4],...l}}}catch(e){return console.warn("Failed to parse cookie string:",e),null}}function mn(r){var e;return JSON.stringify([r.access_token,r.refresh_token,r.provider_token,r.provider_refresh_token,((e=r.user)==null?void 0:e.factors)??null])}function dt(){return!1}var lr={path:"/",maxAge:60*60*24*365*1e3},_n=class{constructor(r){this.cookieOptions={...lr,...r,maxAge:lr.maxAge}}getItem(r){let e=this.getCookie(r);return e?r.endsWith("-code-verifier")?e:JSON.stringify(gn(e)):null}setItem(r,e){if(r.endsWith("-code-verifier")){this.setCookie(r,e);return}let t=JSON.parse(e),n=mn(t);this.setCookie(r,n)}removeItem(r){this.deleteCookie(r)}},Ri=class extends _n{constructor(r){super(r)}getCookie(r){return dt()?(0,cr.parse)(document.cookie)[r]:null}setCookie(r,e){if(!dt())return null;document.cookie=(0,cr.serialize)(r,e,{...this.cookieOptions,httpOnly:!1})}deleteCookie(r){if(!dt())return null;document.cookie=(0,cr.serialize)(r,"",{...this.cookieOptions,maxAge:0,httpOnly:!1})}};function Ji(r,e,t){var n;let s=dt();return Ci(r,e,{...t,auth:{flowType:"pkce",autoRefreshToken:s,detectSessionInUrl:s,persistSession:!0,storage:t.auth.storage,...(n=t.auth)!=null&&n.storageKey?{storageKey:t.auth.storageKey}:{}}})}var Li=yn.parse,Hi=yn.serialize;},8512:Z=>{"use strict";Z.exports={version:"1.0.34"}}},Z=>{var q=E=>Z(Z.s=E),S=q(3780);(Ne=typeof Ne>"u"?{}:Ne).middleware_middleware=S}]);var Bi=function(){let Z={exports:{},loaded:!1};return function(S,E){var W=Object.defineProperty,J=C=>W(C,"__esModule",{value:!0}),Y=(C,U)=>{J(C);for(var H in U)W(C,H,{get:U[H],enumerable:!0})};Y(E,{default:()=>R});function w(C){let U={};return C&&C.forEach((H,K)=>{U[K]=H,K.toLowerCase()==="set-cookie"&&(U[K]=L(H))}),U}function L(C){let U=[],H=0,K,V,Q,se,y;function A(){for(;H<C.length&&/\s/.test(C.charAt(H));)H+=1;return H<C.length}function x(){return V=C.charAt(H),V!=="="&&V!==";"&&V!==","}for(;H<C.length;){for(K=H,y=!1;A();)if(V=C.charAt(H),V===","){for(Q=H,H+=1,A(),se=H;H<C.length&&x();)H+=1;H<C.length&&C.charAt(H)==="="?(y=!0,H=se,U.push(C.substring(K,Q)),K=H):H=Q+1}else H+=1;(!y||H>=C.length)&&U.push(C.substring(K,C.length))}return U}function R(C){let U=C.staticRoutes.map(K=>({regexp:new RegExp(K.namedRegex),page:K.page})),H=C.dynamicRoutes?.map(K=>({regexp:new RegExp(K.namedRegex),page:K.page}))||[];return async function(K,V){let Q=new URL(K.url).pathname,se={};if(C.nextConfig?.basePath&&Q.startsWith(C.nextConfig.basePath)&&(Q=Q.replace(C.nextConfig.basePath,"")||"/"),C.nextConfig?.i18n)for(let A of C.nextConfig.i18n.locales){let x=new RegExp(`^/${A}($|/)`,"i");if(Q.match(x)){Q=Q.replace(x,"/")||"/";break}}for(let A of U)if(A.regexp.exec(Q)){se.name=A.page;break}if(!se.name){let A=$(Q);for(let x of H||[]){if(A&&!$(x.page))continue;let F=x.regexp.exec(Q);if(F){se={name:x.page,params:F.groups};break}}}let y=await Ne[`middleware_${C.name}`].default.call({},{request:{url:K.url,method:K.method,headers:w(K.headers),ip:j(K.headers,z.Ip),geo:{city:j(K.headers,z.City,!0),country:j(K.headers,z.Country,!0),latitude:j(K.headers,z.Latitude),longitude:j(K.headers,z.Longitude),region:j(K.headers,z.Region,!0)},nextConfig:C.nextConfig,page:se,body:K.body}});return V.waitUntil(y.waitUntil),y.response}}function j(C,U,H=!1){let K=C.get(U)||void 0;return H&&K?decodeURIComponent(K):K}function $(C){return C==="/api"||C.startsWith("/api/")}var z;(function(C){C.City="x-vercel-ip-city",C.Country="x-vercel-ip-country",C.Ip="x-real-ip",C.Latitude="x-vercel-ip-latitude",C.Longitude="x-vercel-ip-longitude",C.Region="x-vercel-ip-country-region"})(z||(z={}))}(Z,Z.exports),Z.exports}.call({}).default({name:"middleware",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/favicon.ico",regex:"^/favicon\\.ico(?:/)?$",routeKeys:{},namedRegex:"^/favicon\\.ico(?:/)?$"},{page:"/tweets",regex:"^/tweets(?:/)?$",routeKeys:{},namedRegex:"^/tweets(?:/)?$"}],dynamicRoutes:[],nextConfig:{basePath:""}});export{Bi as default};
/*!
* cookie
* Copyright(c) 2012-2014 Roman Shtylman
* Copyright(c) 2015 Douglas Christopher Wilson
* MIT Licensed
*/
/*! Bundled license information:

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)
*/
